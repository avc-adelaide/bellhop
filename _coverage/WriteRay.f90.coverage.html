<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coverage Report: WriteRay.f90</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            margin: 20px;
            background-color: #f9f9f9;
        }
        .header {
            background-color: #2c3e50;
            color: white;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .summary {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        .metric {
            background-color: #ecf0f1;
            padding: 10px;
            border-radius: 3px;
            text-align: center;
            min-width: 120px;
        }
        .metric-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #27ae60;
        }
        .code-container {
            background-color: white;
            border: 1px solid #bdc3c7;
            border-radius: 5px;
            overflow: auto;
        }
        .code-line {
            display: flex;
            border-bottom: 1px solid #ecf0f1;
        }
        .line-number {
            background-color: #f8f9fa;
            padding: 2px 8px;
            width: 60px;
            text-align: right;
            border-right: 1px solid #dee2e6;
            color: #6c757d;
        }
        .execution-count {
            background-color: #f8f9fa;
            padding: 2px 8px;
            width: 80px;
            text-align: right;
            border-right: 1px solid #dee2e6;
            color: #495057;
        }
        .source-code {
            padding: 2px 8px;
            flex: 1;
            white-space: pre;
        }
        .executed { background-color: #d4edda; }
        .not-executed { background-color: #f8d7da; }
        .non-executable { background-color: #f8f9fa; }
        .footer {
            margin-top: 20px;
            padding: 15px;
            background-color: #e9ecef;
            border-radius: 5px;
            font-size: 0.9em;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Coverage Report: WriteRay.f90</h1>
        <p>Generated from GCOV analysis of Fortran source code</p>
    </div>

    <div class="summary">
        <div class="metric">
            <div class="metric-value">39.4%</div>
            <div>Lines Executed</div>
            <div>33 total lines</div>
        </div>
        <div class="metric">
            <div class="metric-value">58.7%</div>
            <div>Branches Executed</div>
            <div>46 total branches</div>
        </div>
        <div class="metric">
            <div class="metric-value">100.0%</div>
            <div>Calls Executed</div>
            <div>11 total calls</div>
        </div>
    </div>

    <div class="code-container">
        <div class="code-line non-executable">
            <div class="line-number">0</div>
            <div class="execution-count">-</div>
            <div class="source-code">Source:WriteRay.f90</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">0</div>
            <div class="execution-count">-</div>
            <div class="source-code">Graph:WriteRay.gcno</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">0</div>
            <div class="execution-count">-</div>
            <div class="source-code">Data:WriteRay.gcda</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">0</div>
            <div class="execution-count">-</div>
            <div class="source-code">Runs:57</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">1</div>
            <div class="execution-count">-</div>
            <div class="source-code">!! Ray data compression and output formatting</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">2</div>
            <div class="execution-count">-</div>
            <div class="source-code">MODULE WriteRay</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">3</div>
            <div class="execution-count">-</div>
            <div class="source-code">  !! Ray data compression, formatting, and output to ray files with selective point retention</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">4</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">5</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! Compress the ray data keeping every iSkip point, points near surface or bottom, and last point.</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">6</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! Write to RAYFile.</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">7</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">8</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! During an eigenray calculation, subsets of the full ray may be passed</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">9</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! These have lengths Nsteps1 vs. Nsteps for the entire ray</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">10</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">11</div>
            <div class="execution-count">-</div>
            <div class="source-code">  USE BellhopMod</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">12</div>
            <div class="execution-count">-</div>
            <div class="source-code">  USE sspMod</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">13</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">14</div>
            <div class="execution-count">-</div>
            <div class="source-code">  IMPLICIT NONE</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">15</div>
            <div class="execution-count">-</div>
            <div class="source-code">  PUBLIC</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">16</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">17</div>
            <div class="execution-count">-</div>
            <div class="source-code">  INTEGER, PRIVATE :: MaxNRayPoints = 500000   ! this is the maximum length of the ray vector that is written out</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">18</div>
            <div class="execution-count">-</div>
            <div class="source-code">  INTEGER, PRIVATE :: is, N2, iSkip</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">19</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">20</div>
            <div class="execution-count">-</div>
            <div class="source-code">CONTAINS</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">21</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line executed">
            <div class="line-number">22</div>
            <div class="execution-count">490</div>
            <div class="source-code">  SUBROUTINE WriteRay2D( alpha0, Nsteps1 )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">23</div>
            <div class="execution-count">-</div>
            <div class="source-code">    !! The 2D version is for ray traces in (r,z) coordinates</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">24</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">25</div>
            <div class="execution-count">-</div>
            <div class="source-code">    INTEGER,       INTENT( IN ) :: Nsteps1</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">26</div>
            <div class="execution-count">-</div>
            <div class="source-code">    REAL (KIND=8), INTENT( IN ) :: alpha0   ! take-off angle of this ray</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">27</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">28</div>
            <div class="execution-count">-</div>
            <div class="source-code">    ! compression</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">29</div>
            <div class="execution-count">-</div>
            <div class="source-code">    ! LP: This is silly for two reasons:</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">30</div>
            <div class="execution-count">-</div>
            <div class="source-code">    ! 1) MaxN (maximum number of steps for a ray) is 100000, but MaxNRayPoints</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">31</div>
            <div class="execution-count">-</div>
            <div class="source-code">    !    is 500000. Therefore iSkip will always be 1, and the whole vector will</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">32</div>
            <div class="execution-count">-</div>
            <div class="source-code">    !    always be written.</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">33</div>
            <div class="execution-count">-</div>
            <div class="source-code">    ! 2) Even if these constants were changed, the formula for iSkip is not</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">34</div>
            <div class="execution-count">-</div>
            <div class="source-code">    !    ideal: iSkip will only become 2 once the number of steps in the ray is</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">35</div>
            <div class="execution-count">-</div>
            <div class="source-code">    !    more than 2x MaxNRayPoints. If it&#x27;s less than this, it&#x27;ll just be</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">36</div>
            <div class="execution-count">-</div>
            <div class="source-code">    !    truncated, which is arguably worse than skipping every other step.</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">37</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line executed">
            <div class="line-number">38</div>
            <div class="execution-count">490</div>
            <div class="source-code">    N2    = 1</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">39</div>
            <div class="execution-count">490</div>
            <div class="source-code">    iSkip = MAX( Nsteps1 / MaxNRayPoints, 1 )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">40</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">41</div>
            <div class="execution-count">179247*</div>
            <div class="source-code">    Stepping: DO is = 2, Nsteps1</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">42</div>
            <div class="execution-count">-</div>
            <div class="source-code">       ! ensure that we always write ray points near bdry reflections (works only for flat bdry)</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">43</div>
            <div class="execution-count">357514*</div>
            <div class="source-code">       IF ( MIN( Bdry%Bot%HS%Depth - ray2D( is )%x( 2 ),  ray2D( is )%x( 2 ) - Bdry%Top%HS%Depth ) &lt; 0.2 .OR. &amp;</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">44</div>
            <div class="execution-count">536761</div>
            <div class="source-code">            MOD( is, iSkip ) == 0 .OR. is == Nsteps1 ) THEN</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">45</div>
            <div class="execution-count">178757</div>
            <div class="source-code">          N2 = N2 + 1</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">46</div>
            <div class="execution-count">536271*</div>
            <div class="source-code">          ray2D( N2 )%x = ray2D( is )%x</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">47</div>
            <div class="execution-count">-</div>
            <div class="source-code">       END IF</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">48</div>
            <div class="execution-count">-</div>
            <div class="source-code">    END DO Stepping</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">49</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">50</div>
            <div class="execution-count">-</div>
            <div class="source-code">    ! write to ray file</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">51</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line executed">
            <div class="line-number">52</div>
            <div class="execution-count">490</div>
            <div class="source-code">    WRITE( RAYFile, * ) alpha0</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">53</div>
            <div class="execution-count">490*</div>
            <div class="source-code">    WRITE( RAYFile, * ) N2, ray2D( Nsteps1 )%NumTopBnc, ray2D( Nsteps1 )%NumBotBnc</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">54</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">55</div>
            <div class="execution-count">179737*</div>
            <div class="source-code">    DO is = 1, N2</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">56</div>
            <div class="execution-count">538231*</div>
            <div class="source-code">       WRITE( RAYFile, * ) ray2D( is )%x</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">57</div>
            <div class="execution-count">-</div>
            <div class="source-code">    END DO</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">58</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line executed">
            <div class="line-number">59</div>
            <div class="execution-count">490</div>
            <div class="source-code">  END SUBROUTINE WriteRay2D</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">60</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">61</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! **********************************************************************!</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">62</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">63</div>
            <div class="execution-count">#####</div>
            <div class="source-code">  SUBROUTINE WriteRay3D( alpha0, beta0, Nsteps1 )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">64</div>
            <div class="execution-count">-</div>
            <div class="source-code">    !! The 3D version is for ray traces in (x,y,z) coordinates</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">65</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">66</div>
            <div class="execution-count">-</div>
            <div class="source-code">    INTEGER,       INTENT( IN ) :: Nsteps1</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">67</div>
            <div class="execution-count">-</div>
            <div class="source-code">    REAL (KIND=8), INTENT( IN ) :: alpha0, beta0   ! take-off angle of this ray</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">68</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">69</div>
            <div class="execution-count">-</div>
            <div class="source-code">    ! if Nx2D run, copy r-z rays to x-y-z rays</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">70</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">71</div>
            <div class="execution-count">#####</div>
            <div class="source-code">    IF ( Beam%RunType( 6 : 6 ) == &#x27;2&#x27; ) THEN</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">72</div>
            <div class="execution-count">#####</div>
            <div class="source-code">       ray3D%x( 1 )    = xs_3D( 1 ) + ray2D%x( 1 ) * COS( beta0 )</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">73</div>
            <div class="execution-count">#####</div>
            <div class="source-code">       ray3D%x( 2 )    = xs_3D( 2 ) + ray2D%x( 1 ) * SIN( beta0 )</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">74</div>
            <div class="execution-count">#####</div>
            <div class="source-code">       ray3D%x( 3 )    = ray2D%x( 2 )</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">75</div>
            <div class="execution-count">#####</div>
            <div class="source-code">       ray3D%NumTopBnc = ray2D%NumTopBnc</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">76</div>
            <div class="execution-count">#####</div>
            <div class="source-code">       ray3D%NumBotBnc = ray2D%NumBotBnc</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">77</div>
            <div class="execution-count">-</div>
            <div class="source-code">    END IF</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">78</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">79</div>
            <div class="execution-count">-</div>
            <div class="source-code">    ! compression</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">80</div>
            <div class="execution-count">-</div>
            <div class="source-code">    ! LP: Besides the problems mentioned above in the 2D version, this also does</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">81</div>
            <div class="execution-count">-</div>
            <div class="source-code">    ! nothing because iSkip is overridden to 1 below.</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">82</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">83</div>
            <div class="execution-count">#####</div>
            <div class="source-code">    N2    = 1</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">84</div>
            <div class="execution-count">#####</div>
            <div class="source-code">    iSkip = MAX( Nsteps1 / MaxNRayPoints, 1 )</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">85</div>
            <div class="execution-count">#####</div>
            <div class="source-code">    iSkip = 1</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">86</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">87</div>
            <div class="execution-count">#####</div>
            <div class="source-code">    Stepping: DO is = 2, Nsteps1</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">88</div>
            <div class="execution-count">-</div>
            <div class="source-code">       ! ensure that we always write ray points near boundary reflections</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">89</div>
            <div class="execution-count">#####</div>
            <div class="source-code">       IF ( MIN( Bdry%Bot%HS%Depth - ray3D( is )%x( 3 ),  ray3D( is )%x( 3 ) - Bdry%Top%HS%Depth ) &lt; 0.2 .OR. &amp;</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">90</div>
            <div class="execution-count">#####</div>
            <div class="source-code">            MOD( is, iSkip ) == 0 .OR. is == Nsteps1 ) THEN</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">91</div>
            <div class="execution-count">#####</div>
            <div class="source-code">          N2 = N2 + 1</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">92</div>
            <div class="execution-count">#####</div>
            <div class="source-code">          ray3D( N2 )%x = ray3D( is )%x</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">93</div>
            <div class="execution-count">-</div>
            <div class="source-code">       END IF</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">94</div>
            <div class="execution-count">-</div>
            <div class="source-code">    END DO Stepping</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">95</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">96</div>
            <div class="execution-count">-</div>
            <div class="source-code">    ! write to ray file</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">97</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">98</div>
            <div class="execution-count">#####</div>
            <div class="source-code">    WRITE( RAYFile, * ) alpha0</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">99</div>
            <div class="execution-count">#####</div>
            <div class="source-code">    WRITE( RAYFile, * ) N2, ray3D( Nsteps1 )%NumTopBnc, ray3D( Nsteps1 )%NumBotBnc</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">100</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">101</div>
            <div class="execution-count">#####</div>
            <div class="source-code">    DO is = 1, N2</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">102</div>
            <div class="execution-count">#####</div>
            <div class="source-code">       WRITE( RAYFile, * ) ray3D( is )%x</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">103</div>
            <div class="execution-count">-</div>
            <div class="source-code">    END DO</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">104</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">105</div>
            <div class="execution-count">#####</div>
            <div class="source-code">  END SUBROUTINE WriteRay3D</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">106</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">107</div>
            <div class="execution-count">-</div>
            <div class="source-code">END MODULE WriteRay</div>
        </div>
    </div>

    <div class="footer">
        <p><strong>Legend:</strong></p>
        <ul>
            <li><span style="background-color: #d4edda; padding: 2px 4px;">Green</span> - Executed lines</li>
            <li><span style="background-color: #f8d7da; padding: 2px 4px;">Red</span> - Not executed lines</li>
            <li><span style="background-color: #f8f9fa; padding: 2px 4px;">Gray</span> - Non-executable lines (comments, declarations)</li>
        </ul>
        <p><strong>Execution Count:</strong> Number of times each line was executed. ##### indicates never executed, - indicates non-executable.</p>
    </div>
</body>
</html>