<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coverage Report: bellhop.f90</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            margin: 20px;
            background-color: #f9f9f9;
        }
        .header {
            background-color: #2c3e50;
            color: white;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .summary {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        .metric {
            background-color: #ecf0f1;
            padding: 10px;
            border-radius: 3px;
            text-align: center;
            min-width: 120px;
        }
        .metric-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #27ae60;
        }
        .code-container {
            background-color: white;
            border: 1px solid #bdc3c7;
            border-radius: 5px;
            overflow: auto;
        }
        .code-line {
            display: flex;
            border-bottom: 1px solid #ecf0f1;
        }
        .line-number {
            background-color: #f8f9fa;
            padding: 2px 8px;
            width: 60px;
            text-align: right;
            border-right: 1px solid #dee2e6;
            color: #6c757d;
        }
        .execution-count {
            background-color: #f8f9fa;
            padding: 2px 8px;
            width: 80px;
            text-align: right;
            border-right: 1px solid #dee2e6;
            color: #495057;
        }
        .source-code {
            padding: 2px 8px;
            flex: 1;
            white-space: pre;
        }
        .executed { background-color: #d4edda; }
        .not-executed { background-color: #f8d7da; }
        .non-executable { background-color: #f8f9fa; }
        .footer {
            margin-top: 20px;
            padding: 15px;
            background-color: #e9ecef;
            border-radius: 5px;
            font-size: 0.9em;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Coverage Report: bellhop.f90</h1>
        <p>Generated from GCOV analysis of Fortran source code</p>
    </div>

    <div class="summary">
        <div class="metric">
            <div class="metric-value">69.6%</div>
            <div>Lines Executed</div>
            <div>342 total lines</div>
        </div>
        <div class="metric">
            <div class="metric-value">55.6%</div>
            <div>Branches Executed</div>
            <div>934 total branches</div>
        </div>
        <div class="metric">
            <div class="metric-value">100.0%</div>
            <div>Calls Executed</div>
            <div>96 total calls</div>
        </div>
    </div>

    <div class="code-container">
        <div class="code-line non-executable">
            <div class="line-number">0</div>
            <div class="execution-count">-</div>
            <div class="source-code">Source:bellhop.f90</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">0</div>
            <div class="execution-count">-</div>
            <div class="source-code">Graph:bellhop.gcno</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">0</div>
            <div class="execution-count">-</div>
            <div class="source-code">Data:bellhop.gcda</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">0</div>
            <div class="execution-count">-</div>
            <div class="source-code">Runs:57</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">1</div>
            <div class="execution-count">-</div>
            <div class="source-code">!! Provides BELLHOP program definition</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">2</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line executed">
            <div class="line-number">3</div>
            <div class="execution-count">57</div>
            <div class="source-code">PROGRAM BELLHOP</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">4</div>
            <div class="execution-count">-</div>
            <div class="source-code">!! BELLHOP beam tracing for ocean acoustics</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">5</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">6</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! BELLHOP Beam tracing for ocean acoustics</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">7</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">8</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! Copyright (C) 2009 Michael B. Porter</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">9</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">10</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! This program is free software: you can redistribute it and/or modify</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">11</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! it under the terms of the GNU General Public License as published by</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">12</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! the Free Software Foundation, either version 3 of the License, or</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">13</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! (at your option) any later version.</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">14</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">15</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! This program is distributed in the hope that it will be useful,</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">16</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! but WITHOUT ANY WARRANTY; without even the implied warranty of</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">17</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">18</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! GNU General Public License for more details.</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">19</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">20</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! You should have received a copy of the GNU General Public License</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">21</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">22</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">23</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! First version (1983) originally developed with Homer Bucker, Naval Ocean Systems Center</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">24</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line executed">
            <div class="line-number">25</div>
            <div class="execution-count">57</div>
            <div class="source-code">  USE ReadEnvironmentBell</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">26</div>
            <div class="execution-count">-</div>
            <div class="source-code">  USE BeamPattern</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">27</div>
            <div class="execution-count">-</div>
            <div class="source-code">  USE bdryMod</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">28</div>
            <div class="execution-count">-</div>
            <div class="source-code">  USE RefCoef</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">29</div>
            <div class="execution-count">-</div>
            <div class="source-code">  USE SourceReceiverPositions</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">30</div>
            <div class="execution-count">-</div>
            <div class="source-code">  USE angleMod</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">31</div>
            <div class="execution-count">-</div>
            <div class="source-code">  USE sspMod</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">32</div>
            <div class="execution-count">-</div>
            <div class="source-code">  USE influence</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">33</div>
            <div class="execution-count">-</div>
            <div class="source-code">  USE FatalError</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">34</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">35</div>
            <div class="execution-count">-</div>
            <div class="source-code">  IMPLICIT NONE</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">36</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">37</div>
            <div class="execution-count">-</div>
            <div class="source-code">  LOGICAL, PARAMETER   :: Inline = .FALSE.</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">38</div>
            <div class="execution-count">-</div>
            <div class="source-code">  INTEGER              :: jj</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">39</div>
            <div class="execution-count">-</div>
            <div class="source-code">  CHARACTER ( LEN=2  ) :: AttenUnit</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">40</div>
            <div class="execution-count">-</div>
            <div class="source-code">  CHARACTER ( LEN=80 ) :: FileRoot</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">41</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line executed">
            <div class="line-number">42</div>
            <div class="execution-count">57</div>
            <div class="source-code">  ThreeD = .FALSE.</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">43</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">44</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! get the file root for naming all input and output files</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">45</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! should add some checks here ...</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">46</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line executed">
            <div class="line-number">47</div>
            <div class="execution-count">57</div>
            <div class="source-code">  CALL GET_COMMAND_ARGUMENT( 1, FileRoot )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">48</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! Open the print file</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">49</div>
            <div class="execution-count">57*</div>
            <div class="source-code">  OPEN( UNIT = PRTFile, FILE = TRIM( FileRoot ) // &#x27;.prt&#x27;, STATUS = &#x27;UNKNOWN&#x27;, IOSTAT = iostat )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">50</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">51</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! Read in or otherwise initialize inline all the variables used by BELLHOP</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">52</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">53</div>
            <div class="execution-count">-</div>
            <div class="source-code">  IF ( Inline ) THEN</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">54</div>
            <div class="execution-count">-</div>
            <div class="source-code">     ! NPts, Sigma not used by BELLHOP</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">55</div>
            <div class="execution-count">-</div>
            <div class="source-code">     Title = &#x27;BELLHOP- Calibration case with envfil passed as parameters&#x27;</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">56</div>
            <div class="execution-count">-</div>
            <div class="source-code">     freq  = 250</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">57</div>
            <div class="execution-count">-</div>
            <div class="source-code">     ! NMedia variable is not used by BELLHOP</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">58</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">59</div>
            <div class="execution-count">-</div>
            <div class="source-code">     ! *** Boundary information (type of boundary condition and, if a halfspace, then halfspace info)</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">60</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">61</div>
            <div class="execution-count">-</div>
            <div class="source-code">     AttenUnit         = &#x27;W&#x27;</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">62</div>
            <div class="execution-count">-</div>
            <div class="source-code">     Bdry%Top%HS%BC    = &#x27;V&#x27;</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">63</div>
            <div class="execution-count">-</div>
            <div class="source-code">     Bdry%Top%HS%Depth = 0</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">64</div>
            <div class="execution-count">-</div>
            <div class="source-code">     Bdry%Bot%HS%Depth = 100</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">65</div>
            <div class="execution-count">-</div>
            <div class="source-code">     Bdry%Bot%HS%Opt   = &#x27;A_&#x27;</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">66</div>
            <div class="execution-count">-</div>
            <div class="source-code">     Bdry%Bot%HS%BC    = &#x27;A&#x27;</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">67</div>
            <div class="execution-count">-</div>
            <div class="source-code">     Bdry%Bot%HS%cp    = CRCI( 1D20, 1590D0,    0.5D0, freq, freq, AttenUnit, betaPowerLaw, fT )   ! compressional wave speed</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">68</div>
            <div class="execution-count">-</div>
            <div class="source-code">     Bdry%Bot%HS%cs    = CRCI( 1D20,    0D0,      0D0, freq, freq, AttenUnit, betaPowerLaw, fT )   ! shear         wave speed</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">69</div>
            <div class="execution-count">-</div>
            <div class="source-code">     Bdry%Bot%HS%rho   = 1.2                               ! density</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">70</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">71</div>
            <div class="execution-count">-</div>
            <div class="source-code">     ! *** sound speed in the water column ***</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">72</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">73</div>
            <div class="execution-count">-</div>
            <div class="source-code">     SSP%Type = &#x27;C&#x27;   ! interpolation method for SSP</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">74</div>
            <div class="execution-count">-</div>
            <div class="source-code">     SSP%NPts = 2     ! number of SSP points</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">75</div>
            <div class="execution-count">-</div>
            <div class="source-code">     SSP%z(  1 : 2 ) = [    0,  100 ]</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">76</div>
            <div class="execution-count">-</div>
            <div class="source-code">     SSP%c(  1 : 2 ) = [ 1500, 1500 ]</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">77</div>
            <div class="execution-count">-</div>
            <div class="source-code">     SSP%cz( 1 : 2 ) = [    0,    0 ]   ! user should really not have to supply this ...</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">78</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">79</div>
            <div class="execution-count">-</div>
            <div class="source-code">     ! *** source and receiver positions ***</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">80</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">81</div>
            <div class="execution-count">-</div>
            <div class="source-code">     Pos%NSz = 1</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">82</div>
            <div class="execution-count">-</div>
            <div class="source-code">     Pos%NRz = 100</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">83</div>
            <div class="execution-count">-</div>
            <div class="source-code">     Pos%NRr  = 500</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">84</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">85</div>
            <div class="execution-count">-</div>
            <div class="source-code">     ALLOCATE( Pos%sz( Pos%NSz ), Pos%ws( Pos%NSz ), Pos%isz( Pos%NSz ) )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">86</div>
            <div class="execution-count">-</div>
            <div class="source-code">     ALLOCATE( Pos%rz( Pos%NRz ), Pos%wr( Pos%NRz ), Pos%irz( Pos%NRz ) )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">87</div>
            <div class="execution-count">-</div>
            <div class="source-code">     ALLOCATE( Pos%Rr(  Pos%NRr  ) )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">88</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">89</div>
            <div class="execution-count">-</div>
            <div class="source-code">     Pos%Sz( 1 ) = 50.</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">90</div>
            <div class="execution-count">-</div>
            <div class="source-code">     !Pos%Rz     = [ 0, 50, 100 ]</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">91</div>
            <div class="execution-count">-</div>
            <div class="source-code">     !Pos%Rr     = 1000. * [ 1, 2, 3, 4, 5 ]   ! meters !!!</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">92</div>
            <div class="execution-count">-</div>
            <div class="source-code">     Pos%Rz      = [ ( jj, jj = 1, Pos%NRz ) ]</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">93</div>
            <div class="execution-count">-</div>
            <div class="source-code">     Pos%Rr      = 10. * [ ( jj, jj = 1 , Pos%NRr ) ]   ! meters !!!</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">94</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">95</div>
            <div class="execution-count">-</div>
            <div class="source-code">     Beam%RunType = &#x27;C&#x27;</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">96</div>
            <div class="execution-count">-</div>
            <div class="source-code">     Beam%Type    = &#x27;G   &#x27;</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">97</div>
            <div class="execution-count">-</div>
            <div class="source-code">     Beam%deltas  = 0</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">98</div>
            <div class="execution-count">-</div>
            <div class="source-code">     Beam%Box%z   = 101.</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">99</div>
            <div class="execution-count">-</div>
            <div class="source-code">     Beam%Box%r   = 5100 ! meters</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">100</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">101</div>
            <div class="execution-count">-</div>
            <div class="source-code">     Angles%Nalpha = 1789</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">102</div>
            <div class="execution-count">-</div>
            <div class="source-code">     ! Angles%alpha  = [ -80, -70, -60, -50, -40, -30, -20, -10, 0, 10, 20, 30, 40, 50, 60, 70, 80 ] ! -89 89</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">103</div>
            <div class="execution-count">-</div>
            <div class="source-code">     Angles%alpha  = ( 180. / Angles%Nalpha ) * [ ( jj, jj = 1, Angles%Nalpha ) ] - 90.</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">104</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">105</div>
            <div class="execution-count">-</div>
            <div class="source-code">     ! *** altimetry ***</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">106</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">107</div>
            <div class="execution-count">-</div>
            <div class="source-code">     ALLOCATE( Top( 2 ), Stat = IAllocStat )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">108</div>
            <div class="execution-count">-</div>
            <div class="source-code">     IF ( IAllocStat /= 0 ) CALL ERROUT( &#x27;BELLHOP&#x27;, &#x27;Insufficient memory for altimetry data&#x27;  )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">109</div>
            <div class="execution-count">-</div>
            <div class="source-code">     Top( 1 )%x = [ -sqrt( huge( Top( 1 )%x( 1 ) ) ) / 1.0d5, 0.d0 ]</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">110</div>
            <div class="execution-count">-</div>
            <div class="source-code">     Top( 2 )%x = [  sqrt( huge( Top( 1 )%x( 1 ) ) ) / 1.0d5, 0.d0 ]</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">111</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">112</div>
            <div class="execution-count">-</div>
            <div class="source-code">     CALL ComputeBdryTangentNormal( Top, &#x27;Top&#x27; )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">113</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">114</div>
            <div class="execution-count">-</div>
            <div class="source-code">     ! *** bathymetry ***</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">115</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">116</div>
            <div class="execution-count">-</div>
            <div class="source-code">     ALLOCATE( Bot( 2 ), Stat = IAllocStat )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">117</div>
            <div class="execution-count">-</div>
            <div class="source-code">     IF ( IAllocStat /= 0 ) CALL ERROUT( &#x27;BELLHOP&#x27;, &#x27;Insufficient memory for bathymetry data&#x27;  )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">118</div>
            <div class="execution-count">-</div>
            <div class="source-code">     Bot( 1 )%x = [ -sqrt( huge( Bot( 1 )%x( 1 ) ) ) / 1.0d5, 5000.d0 ]</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">119</div>
            <div class="execution-count">-</div>
            <div class="source-code">     Bot( 2 )%x = [  sqrt( huge( Bot( 1 )%x( 1 ) ) ) / 1.0d5, 5000.d0 ]</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">120</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">121</div>
            <div class="execution-count">-</div>
            <div class="source-code">     CALL ComputeBdryTangentNormal( Bot, &#x27;Bot&#x27; )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">122</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">123</div>
            <div class="execution-count">-</div>
            <div class="source-code">     ALLOCATE( RBot( 1 ), Stat = IAllocStat )   ! bottom reflection coefficient</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">124</div>
            <div class="execution-count">-</div>
            <div class="source-code">     ALLOCATE( RTop( 1 ), Stat = iAllocStat )   ! top    reflection coefficient</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">125</div>
            <div class="execution-count">-</div>
            <div class="source-code">     NBotPts = 1 ! LP: missing initialization</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">126</div>
            <div class="execution-count">-</div>
            <div class="source-code">     NTopPts = 1</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">127</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">128</div>
            <div class="execution-count">-</div>
            <div class="source-code">     ! *** Source Beam Pattern ***</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">129</div>
            <div class="execution-count">-</div>
            <div class="source-code">     NSBPPts = 2</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">130</div>
            <div class="execution-count">-</div>
            <div class="source-code">     ALLOCATE( SrcBmPat( 2, 2 ), Stat = IAllocStat )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">131</div>
            <div class="execution-count">-</div>
            <div class="source-code">     IF ( IAllocStat /= 0 ) CALL ERROUT( &#x27;BELLHOP-ReadPat&#x27;, &#x27;Insufficient memory&#x27;  )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">132</div>
            <div class="execution-count">-</div>
            <div class="source-code">     SrcBmPat( 1, : ) = [ -180.0, 0.0 ]</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">133</div>
            <div class="execution-count">-</div>
            <div class="source-code">     SrcBmPat( 2, : ) = [  180.0, 0.0 ]</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">134</div>
            <div class="execution-count">-</div>
            <div class="source-code">     SrcBmPat( :, 2 ) = 10 ** ( SrcBmPat( :, 2 ) / 20 )  ! convert dB to linear scale !!!</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">135</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ELSE</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">136</div>
            <div class="execution-count">57</div>
            <div class="source-code">     CALL ReadEnvironment(  FileRoot, ThreeD )</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">137</div>
            <div class="execution-count">28</div>
            <div class="source-code">     CALL ReadATI( FileRoot, Bdry%Top%HS%Opt( 5 : 5 ), Bdry%Top%HS%Depth, PRTFile )                          ! AlTImetry</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">138</div>
            <div class="execution-count">28</div>
            <div class="source-code">     CALL ReadBTY( FileRoot, Bdry%Bot%HS%Opt( 2 : 2 ), Bdry%Bot%HS%Depth, PRTFile )                          ! BaThYmetry</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">139</div>
            <div class="execution-count">28</div>
            <div class="source-code">     CALL ReadReflectionCoefficient( FileRoot, Bdry%Bot%HS%Opt( 1 : 1 ), Bdry%Top%HS%Opt( 2 : 2 ), PRTFile ) ! (top and bottom)</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">140</div>
            <div class="execution-count">28</div>
            <div class="source-code">     SBPFlag = Beam%RunType( 3 : 3 )</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">141</div>
            <div class="execution-count">28</div>
            <div class="source-code">     CALL ReadPat( FileRoot, PRTFile )   ! Source Beam Pattern</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">142</div>
            <div class="execution-count">-</div>
            <div class="source-code">     ! dummy bearing angles</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">143</div>
            <div class="execution-count">28</div>
            <div class="source-code">     Pos%Ntheta = 1</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">144</div>
            <div class="execution-count">28*</div>
            <div class="source-code">     ALLOCATE( Pos%theta( Pos%Ntheta ), Stat = IAllocStat )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">145</div>
            <div class="execution-count">28*</div>
            <div class="source-code">     Pos%theta( 1 ) = 0.</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">146</div>
            <div class="execution-count">-</div>
            <div class="source-code">  END IF</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">147</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line executed">
            <div class="line-number">148</div>
            <div class="execution-count">28</div>
            <div class="source-code">  CALL OpenOutputFiles( FileRoot, ThreeD )</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">149</div>
            <div class="execution-count">28</div>
            <div class="source-code">  CALL BellhopCore</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">150</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">151</div>
            <div class="execution-count">-</div>
            <div class="source-code">  CONTAINS</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">152</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">153</div>
            <div class="execution-count">-</div>
            <div class="source-code">! **********************************************************************!</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">154</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line executed">
            <div class="line-number">155</div>
            <div class="execution-count">28</div>
            <div class="source-code">SUBROUTINE BellhopCore</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">156</div>
            <div class="execution-count">-</div>
            <div class="source-code">  !! Core subroutine to run Bellhop algorithm</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">157</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">158</div>
            <div class="execution-count">-</div>
            <div class="source-code">  USE ArrMod</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">159</div>
            <div class="execution-count">-</div>
            <div class="source-code">  USE AttenMod</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">160</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">161</div>
            <div class="execution-count">-</div>
            <div class="source-code">  INTEGER, PARAMETER   :: ArrivalsStorage = 200000000, MinNArr = 10</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">162</div>
            <div class="execution-count">-</div>
            <div class="source-code">  INTEGER              :: IBPvec( 1 ), ibp, is, iBeamWindow2, Irz1, Irec, NalphaOpt, iSeg</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">163</div>
            <div class="execution-count">-</div>
            <div class="source-code">  REAL                 :: Tstart, Tstop</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">164</div>
            <div class="execution-count">-</div>
            <div class="source-code">  REAL        (KIND=8) :: Amp0, DalphaOpt, xs( 2 ), tdummy( 2 ), RadMax, s, &amp;</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">165</div>
            <div class="execution-count">-</div>
            <div class="source-code">                          c, cimag, gradc( 2 ), crr, crz, czz, rho</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">166</div>
            <div class="execution-count">28</div>
            <div class="source-code">  COMPLEX, ALLOCATABLE :: U( :, : )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">167</div>
            <div class="execution-count">-</div>
            <div class="source-code">  COMPLEX     (KIND=8) :: epsilon</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">168</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line executed">
            <div class="line-number">169</div>
            <div class="execution-count">28</div>
            <div class="source-code">  CALL CPU_TIME( Tstart )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">170</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line executed">
            <div class="line-number">171</div>
            <div class="execution-count">28</div>
            <div class="source-code">  omega = 2.0 * pi * freq</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">172</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line executed">
            <div class="line-number">173</div>
            <div class="execution-count">28</div>
            <div class="source-code">  IF ( Beam%deltas == 0.0 ) THEN</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">174</div>
            <div class="execution-count">28</div>
            <div class="source-code">     Beam%deltas = ( Bdry%Bot%HS%Depth - Bdry%Top%HS%Depth ) / 10.0   ! Automatic step size selection</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">175</div>
            <div class="execution-count">28</div>
            <div class="source-code">     WRITE( PRTFile, * )</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">176</div>
            <div class="execution-count">28</div>
            <div class="source-code">     WRITE( PRTFile, fmt = &#x27;(  &#x27;&#x27; Step length,       deltas = &#x27;&#x27;, G11.4, &#x27;&#x27; m (automatically selected)&#x27;&#x27; )&#x27; ) Beam%deltas</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">177</div>
            <div class="execution-count">-</div>
            <div class="source-code">  END IF</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">178</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">179</div>
            <div class="execution-count">116058*</div>
            <div class="source-code">  Angles%alpha  = DegRad * Angles%alpha   ! convert to radians</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">180</div>
            <div class="execution-count">28</div>
            <div class="source-code">  Angles%Dalpha = 0.0</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">181</div>
            <div class="execution-count">28</div>
            <div class="source-code">  IF ( Angles%Nalpha /= 1 ) &amp;</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">182</div>
            <div class="execution-count">28*</div>
            <div class="source-code">       Angles%Dalpha = ( Angles%alpha( Angles%Nalpha ) - Angles%alpha( 1 ) ) / ( Angles%Nalpha - 1 )  ! angular spacing between beams</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">183</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">184</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! convert range-dependent geoacoustic parameters from user to program units</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">185</div>
            <div class="execution-count">28</div>
            <div class="source-code">  IF ( atiType( 2 : 2 ) == &#x27;L&#x27; ) THEN</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">186</div>
            <div class="execution-count">#####</div>
            <div class="source-code">     DO iSeg = 1, NatiPts</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">187</div>
            <div class="execution-count">#####</div>
            <div class="source-code">        Top( iSeg )%HS%cp = CRCI( 1D20, Top( iSeg )%HS%alphaR, Top( iSeg )%HS%alphaI, freq, freq, &#x27;W &#x27;, &amp;</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">188</div>
            <div class="execution-count">#####</div>
            <div class="source-code">             betaPowerLaw, ft )   ! compressional wave speed</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">189</div>
            <div class="execution-count">#####</div>
            <div class="source-code">        Top( iSeg )%HS%cs = CRCI( 1D20, Top( iSeg )%HS%betaR,  Top( iSeg )%HS%betaI,  freq, freq, &#x27;W &#x27;, &amp;</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">190</div>
            <div class="execution-count">#####</div>
            <div class="source-code">             betaPowerLaw, ft )   ! shear         wave speed</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">191</div>
            <div class="execution-count">-</div>
            <div class="source-code">     END DO</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">192</div>
            <div class="execution-count">-</div>
            <div class="source-code">  END IF</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">193</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line executed">
            <div class="line-number">194</div>
            <div class="execution-count">28</div>
            <div class="source-code">  IF ( btyType( 2 : 2 ) == &#x27;L&#x27; ) THEN</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">195</div>
            <div class="execution-count">#####</div>
            <div class="source-code">     DO iSeg = 1, NbtyPts</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">196</div>
            <div class="execution-count">#####</div>
            <div class="source-code">        Bot( iSeg )%HS%cp = CRCI( 1D20, Bot( iSeg )%HS%alphaR, Bot( iSeg )%HS%alphaI, freq, freq, &#x27;W &#x27;, &amp;</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">197</div>
            <div class="execution-count">#####</div>
            <div class="source-code">             betaPowerLaw, ft )   ! compressional wave speed</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">198</div>
            <div class="execution-count">#####</div>
            <div class="source-code">        Bot( iSeg )%HS%cs = CRCI( 1D20, Bot( iSeg )%HS%betaR,  Bot( iSeg )%HS%betaI,  freq, freq, &#x27;W &#x27;, &amp;</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">199</div>
            <div class="execution-count">#####</div>
            <div class="source-code">             betaPowerLaw, ft )   ! shear         wave speed</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">200</div>
            <div class="execution-count">-</div>
            <div class="source-code">     END DO</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">201</div>
            <div class="execution-count">-</div>
            <div class="source-code">  END IF</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">202</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">203</div>
            <div class="execution-count">#####</div>
            <div class="source-code">  SELECT CASE ( Beam%RunType( 5 : 5 ) )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">204</div>
            <div class="execution-count">-</div>
            <div class="source-code">  CASE ( &#x27;I&#x27; )</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">205</div>
            <div class="execution-count">#####</div>
            <div class="source-code">     NRz_per_range = 1         ! irregular grid</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">206</div>
            <div class="execution-count">-</div>
            <div class="source-code">  CASE DEFAULT</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">207</div>
            <div class="execution-count">28</div>
            <div class="source-code">     NRz_per_range = Pos%NRz   ! rectilinear grid</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">208</div>
            <div class="execution-count">-</div>
            <div class="source-code">  END SELECT</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">209</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">210</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! for a TL calculation, allocate space for the pressure matrix</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">211</div>
            <div class="execution-count">8</div>
            <div class="source-code">  SELECT CASE ( Beam%RunType( 1 : 1 ) )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">212</div>
            <div class="execution-count">-</div>
            <div class="source-code">  CASE ( &#x27;C&#x27;, &#x27;S&#x27;, &#x27;I&#x27; )        ! TL calculation</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">213</div>
            <div class="execution-count">8*</div>
            <div class="source-code">     ALLOCATE ( U( NRz_per_range, Pos%NRr ), Stat = IAllocStat )</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">214</div>
            <div class="execution-count">8</div>
            <div class="source-code">     IF ( IAllocStat /= 0 ) &amp;</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">215</div>
            <div class="execution-count">8*</div>
            <div class="source-code">          CALL ERROUT( &#x27;BELLHOP&#x27;, &#x27;Insufficient memory for TL matrix: reduce Nr * NRz&#x27;  )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">216</div>
            <div class="execution-count">-</div>
            <div class="source-code">  CASE ( &#x27;A&#x27;, &#x27;a&#x27;, &#x27;R&#x27;, &#x27;E&#x27; )   ! Arrivals calculation</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">217</div>
            <div class="execution-count">28*</div>
            <div class="source-code">     ALLOCATE ( U( 1, 1 ), Stat = IAllocStat )   ! open a dummy variable</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">218</div>
            <div class="execution-count">-</div>
            <div class="source-code">  END SELECT</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">219</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">220</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! for an arrivals run, allocate space for arrivals matrices</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">221</div>
            <div class="execution-count">12</div>
            <div class="source-code">  SELECT CASE ( Beam%RunType( 1 : 1 ) )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">222</div>
            <div class="execution-count">-</div>
            <div class="source-code">  CASE ( &#x27;A&#x27;, &#x27;a&#x27; )</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">223</div>
            <div class="execution-count">12</div>
            <div class="source-code">     MaxNArr = MAX( ArrivalsStorage / ( NRz_per_range * Pos%NRr ), MinNArr )   ! allow space for at least 10 arrivals</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">224</div>
            <div class="execution-count">12</div>
            <div class="source-code">     WRITE( PRTFile, * )</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">225</div>
            <div class="execution-count">12</div>
            <div class="source-code">     WRITE( PRTFile, * ) &#x27;( Maximum # of arrivals = &#x27;, MaxNArr, &#x27;)&#x27;</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">226</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">227</div>
            <div class="execution-count">12*</div>
            <div class="source-code">     ALLOCATE ( Arr( NRz_per_range, Pos%NRr, MaxNArr ), NArr( NRz_per_range, Pos%NRr ), Stat = IAllocStat )</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">228</div>
            <div class="execution-count">12</div>
            <div class="source-code">     IF ( IAllocStat /= 0 ) CALL ERROUT( &#x27;BELLHOP&#x27;, &amp;</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">229</div>
            <div class="execution-count">12*</div>
            <div class="source-code">          &#x27;Insufficient memory to allocate arrivals matrix; reduce parameter ArrivalsStorage&#x27; )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">230</div>
            <div class="execution-count">-</div>
            <div class="source-code">  CASE DEFAULT</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">231</div>
            <div class="execution-count">16</div>
            <div class="source-code">     MaxNArr = 1</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">232</div>
            <div class="execution-count">28*</div>
            <div class="source-code">     ALLOCATE ( Arr( NRz_per_range, Pos%NRr, 1 ), NArr( NRz_per_range, Pos%NRr ), Stat = IAllocStat )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">233</div>
            <div class="execution-count">-</div>
            <div class="source-code">  END SELECT</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">234</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line executed">
            <div class="line-number">235</div>
            <div class="execution-count">28</div>
            <div class="source-code">  WRITE( PRTFile, * )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">236</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">237</div>
            <div class="execution-count">56*</div>
            <div class="source-code">  SourceDepth: DO is = 1, Pos%NSz</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">238</div>
            <div class="execution-count">84*</div>
            <div class="source-code">     xs = [ 0.0, Pos%sz( is ) ]   ! source coordinate</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">239</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line executed">
            <div class="line-number">240</div>
            <div class="execution-count">8</div>
            <div class="source-code">     SELECT CASE ( Beam%RunType( 1 : 1 ) )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">241</div>
            <div class="execution-count">-</div>
            <div class="source-code">     CASE ( &#x27;C&#x27;, &#x27;S&#x27;, &#x27;I&#x27; ) ! TL calculation, zero out pressure matrix</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">242</div>
            <div class="execution-count">1059114*</div>
            <div class="source-code">        U = 0.0</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">243</div>
            <div class="execution-count">-</div>
            <div class="source-code">     CASE ( &#x27;A&#x27;, &#x27;a&#x27; )      ! Arrivals calculation, zero out arrival matrix</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">244</div>
            <div class="execution-count">62*</div>
            <div class="source-code">        NArr = 0</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">245</div>
            <div class="execution-count">-</div>
            <div class="source-code">     END SELECT</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">246</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">247</div>
            <div class="execution-count">-</div>
            <div class="source-code">     ! LP: This initialization was missing (only done once globally). In some</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">248</div>
            <div class="execution-count">-</div>
            <div class="source-code">     ! cases (a source on a boundary), in conjunction with other subtle issues,</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">249</div>
            <div class="execution-count">-</div>
            <div class="source-code">     ! the missing initialization caused the initial state of one ray to be</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">250</div>
            <div class="execution-count">-</div>
            <div class="source-code">     ! dependent on the final state of the previous ray, which is obviously</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">251</div>
            <div class="execution-count">-</div>
            <div class="source-code">     ! non-physical.</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">252</div>
            <div class="execution-count">-</div>
            <div class="source-code">     ! This initialization is here in addition to TraceRay2D because of EvaluateSSP.</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">253</div>
            <div class="execution-count">28</div>
            <div class="source-code">     iSegz = 1</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">254</div>
            <div class="execution-count">28</div>
            <div class="source-code">     iSegr = 1</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">255</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line executed">
            <div class="line-number">256</div>
            <div class="execution-count">28</div>
            <div class="source-code">     tdummy = [ 1.0, 0.0 ]</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">257</div>
            <div class="execution-count">28</div>
            <div class="source-code">     CALL EvaluateSSP( xs, tdummy, c, cimag, gradc, crr, crz, czz, rho, freq, &#x27;TAB&#x27; )</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">258</div>
            <div class="execution-count">28</div>
            <div class="source-code">     RadMax = 5 * c / freq  ! 5 wavelength max radius</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">259</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">260</div>
            <div class="execution-count">-</div>
            <div class="source-code">     ! Are there enough beams?</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">261</div>
            <div class="execution-count">28*</div>
            <div class="source-code">     DalphaOpt = SQRT( c / ( 6.0 * freq * Pos%Rr( Pos%NRr ) ) )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">262</div>
            <div class="execution-count">28*</div>
            <div class="source-code">     NalphaOpt = 2 + INT( ( Angles%alpha( Angles%Nalpha ) - Angles%alpha( 1 ) ) / DalphaOpt )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">263</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line executed">
            <div class="line-number">264</div>
            <div class="execution-count">28</div>
            <div class="source-code">     IF ( Beam%RunType( 1 : 1 ) == &#x27;C&#x27; .AND. Angles%Nalpha &lt; NalphaOpt ) THEN</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">265</div>
            <div class="execution-count">1</div>
            <div class="source-code">        WRITE( PRTFile, * ) &#x27;Warning in BELLHOP : Too few beams&#x27;</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">266</div>
            <div class="execution-count">1</div>
            <div class="source-code">        WRITE( PRTFile, * ) &#x27;Nalpha should be at least = &#x27;, NalphaOpt</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">267</div>
            <div class="execution-count">-</div>
            <div class="source-code">     ENDIF</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">268</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">269</div>
            <div class="execution-count">-</div>
            <div class="source-code">     ! Trace successive beams</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">270</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">271</div>
            <div class="execution-count">116058*</div>
            <div class="source-code">     DeclinationAngle: DO ialpha = 1, Angles%Nalpha</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">272</div>
            <div class="execution-count">116030*</div>
            <div class="source-code">        SrcDeclAngle = RadDeg * Angles%alpha( ialpha )          ! take-off declination angle in degrees</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">273</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line executed">
            <div class="line-number">274</div>
            <div class="execution-count">116058</div>
            <div class="source-code">        IF ( Angles%iSingle_alpha == 0 .OR. ialpha == Angles%iSingle_alpha ) THEN    ! Single beam run?</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">275</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">276</div>
            <div class="execution-count">348090*</div>
            <div class="source-code">           IBPvec = maxloc( SrcBmPat( :, 1 ), mask = SrcBmPat( :, 1 ) &lt; SrcDeclAngle )  ! index of ray angle in beam pattern</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">277</div>
            <div class="execution-count">116030</div>
            <div class="source-code">           IBP    = IBPvec( 1 )</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">278</div>
            <div class="execution-count">116030</div>
            <div class="source-code">           IBP    = MAX( IBP, 1 )               ! don&#x27;t go before beginning of table</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">279</div>
            <div class="execution-count">116030</div>
            <div class="source-code">           IBP    = MIN( IBP, NSBPPts - 1 )     ! don&#x27;t go past end of table</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">280</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">281</div>
            <div class="execution-count">-</div>
            <div class="source-code">           ! linear interpolation to get amplitude</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">282</div>
            <div class="execution-count">116030*</div>
            <div class="source-code">           s    = ( SrcDeclAngle  - SrcBmPat( IBP, 1 ) ) / ( SrcBmPat( IBP + 1, 1 ) - SrcBmPat( IBP, 1 ) )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">283</div>
            <div class="execution-count">116030*</div>
            <div class="source-code">           Amp0 = ( 1 - s ) * SrcBmPat( IBP, 2 ) + s * SrcBmPat( IBP + 1, 2 )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">284</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">285</div>
            <div class="execution-count">-</div>
            <div class="source-code">           ! Lloyd mirror pattern for semi-coherent option</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">286</div>
            <div class="execution-count">116030</div>
            <div class="source-code">           IF ( Beam%RunType( 1 : 1 ) == &#x27;S&#x27; ) &amp;</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">287</div>
            <div class="execution-count">#####</div>
            <div class="source-code">              Amp0 = Amp0 * SQRT( 2.0 ) * ABS( SIN( omega / c * xs( 2 ) * SIN( Angles%alpha( ialpha ) ) ) )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">288</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">289</div>
            <div class="execution-count">-</div>
            <div class="source-code">           ! show progress ...</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">290</div>
            <div class="execution-count">116030</div>
            <div class="source-code">           IF ( MOD( ialpha - 1, max( Angles%Nalpha / 50, 1 ) ) == 0 ) THEN</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">291</div>
            <div class="execution-count">1404</div>
            <div class="source-code">              WRITE( PRTFile, FMT = &quot;( &#x27;Tracing beam &#x27;, I7, F10.2 )&quot; ) ialpha, SrcDeclAngle</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">292</div>
            <div class="execution-count">1404</div>
            <div class="source-code">              FLUSH( PRTFile )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">293</div>
            <div class="execution-count">-</div>
            <div class="source-code">           END IF</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">294</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">295</div>
            <div class="execution-count">116030*</div>
            <div class="source-code">           CALL TraceRay2D( xs, Angles%alpha( ialpha ), Amp0 )   ! Trace a ray</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">296</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line executed">
            <div class="line-number">297</div>
            <div class="execution-count">116030</div>
            <div class="source-code">           IF ( Beam%RunType( 1 : 1 ) == &#x27;R&#x27; ) THEN   ! Write the ray trajectory to RAYFile</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">298</div>
            <div class="execution-count">150</div>
            <div class="source-code">              CALL WriteRay2D( SrcDeclAngle, Beam%Nsteps )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">299</div>
            <div class="execution-count">-</div>
            <div class="source-code">           ELSE                                       ! Compute the contribution to the field</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">300</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">301</div>
            <div class="execution-count">#####</div>
            <div class="source-code">              epsilon = PickEpsilon( Beam%Type( 1 : 2 ), omega, c, gradc, Angles%alpha( ialpha ), &amp;</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">302</div>
            <div class="execution-count">115880</div>
            <div class="source-code">                   Angles%Dalpha, Beam%rLoop, Beam%epsMultiplier ) ! &#x27;optimal&#x27; beam constant</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">303</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">304</div>
            <div class="execution-count">#####</div>
            <div class="source-code">              SELECT CASE ( Beam%Type( 1 : 1 ) )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">305</div>
            <div class="execution-count">-</div>
            <div class="source-code">              CASE ( &#x27;R&#x27; )</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">306</div>
            <div class="execution-count">#####</div>
            <div class="source-code">                 iBeamWindow2 = Beam%iBeamWindow **2</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">307</div>
            <div class="execution-count">#####</div>
            <div class="source-code">                 RadMax       = 50 * c / freq  ! 50 wavelength max radius</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">308</div>
            <div class="execution-count">#####</div>
            <div class="source-code">                 CALL InfluenceCervenyRayCen(   U, epsilon, Angles%alpha( ialpha ), iBeamWindow2, RadMax )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">309</div>
            <div class="execution-count">-</div>
            <div class="source-code">              CASE ( &#x27;C&#x27; )</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">310</div>
            <div class="execution-count">#####</div>
            <div class="source-code">                 iBeamWindow2 = Beam%iBeamWindow **2</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">311</div>
            <div class="execution-count">#####</div>
            <div class="source-code">                 RadMax       = 50 * c / freq  ! 50 wavelength max radius</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">312</div>
            <div class="execution-count">#####</div>
            <div class="source-code">                 CALL InfluenceCervenyCart(     U, epsilon, Angles%alpha( ialpha ), iBeamWindow2, RadMax )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">313</div>
            <div class="execution-count">-</div>
            <div class="source-code">              CASE ( &#x27;g&#x27; )</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">314</div>
            <div class="execution-count">#####</div>
            <div class="source-code">                 CALL InfluenceGeoHatRayCen(    U, Angles%alpha( ialpha ), Angles%Dalpha )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">315</div>
            <div class="execution-count">-</div>
            <div class="source-code">              CASE ( &#x27;S&#x27; )</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">316</div>
            <div class="execution-count">#####</div>
            <div class="source-code">                 RadMax       = 50 * c / freq  ! 50 wavelength max radius</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">317</div>
            <div class="execution-count">#####</div>
            <div class="source-code">                 CALL InfluenceSGB(             U, Angles%alpha( ialpha ), Angles%Dalpha, RadMax )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">318</div>
            <div class="execution-count">-</div>
            <div class="source-code">              CASE ( &#x27;B&#x27; )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">319</div>
            <div class="execution-count">4600*</div>
            <div class="source-code">                 CALL InfluenceGeoGaussianCart( U, Angles%alpha( ialpha ), Angles%Dalpha )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">320</div>
            <div class="execution-count">-</div>
            <div class="source-code">             CASE DEFAULT</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">321</div>
            <div class="execution-count">120480*</div>
            <div class="source-code">                 CALL InfluenceGeoHatCart(      U, Angles%alpha( ialpha ), Angles%Dalpha )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">322</div>
            <div class="execution-count">-</div>
            <div class="source-code">              END SELECT</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">323</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">324</div>
            <div class="execution-count">-</div>
            <div class="source-code">           END IF</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">325</div>
            <div class="execution-count">-</div>
            <div class="source-code">        END IF</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">326</div>
            <div class="execution-count">-</div>
            <div class="source-code">     END DO DeclinationAngle</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">327</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">328</div>
            <div class="execution-count">-</div>
            <div class="source-code">     ! write results to disk</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">329</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line executed">
            <div class="line-number">330</div>
            <div class="execution-count">56</div>
            <div class="source-code">     SELECT CASE ( Beam%RunType( 1 : 1 ) )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">331</div>
            <div class="execution-count">-</div>
            <div class="source-code">     CASE ( &#x27;C&#x27;, &#x27;S&#x27;, &#x27;I&#x27; )   ! TL calculation</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">332</div>
            <div class="execution-count">8*</div>
            <div class="source-code">        CALL ScalePressure( Angles%Dalpha, ray2D( 1 )%c, Pos%Rr, U, NRz_per_range, Pos%NRr, Beam%RunType, freq )</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">333</div>
            <div class="execution-count">8</div>
            <div class="source-code">        IRec = 10 + NRz_per_range * ( is - 1 )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">334</div>
            <div class="execution-count">1420*</div>
            <div class="source-code">        RcvrDepth: DO Irz1 = 1, NRz_per_range</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">335</div>
            <div class="execution-count">1404</div>
            <div class="source-code">           IRec = IRec + 1</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">336</div>
            <div class="execution-count">1412*</div>
            <div class="source-code">           WRITE( SHDFile, REC = IRec ) U( Irz1, 1 : Pos%NRr )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">337</div>
            <div class="execution-count">-</div>
            <div class="source-code">        END DO RcvrDepth</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">338</div>
            <div class="execution-count">-</div>
            <div class="source-code">     CASE ( &#x27;A&#x27; )             ! arrivals calculation, ascii</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">339</div>
            <div class="execution-count">12*</div>
            <div class="source-code">        CALL WriteArrivalsASCII(  Pos%Rr, NRz_per_range, Pos%NRr, Beam%RunType( 4 : 4 ) )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">340</div>
            <div class="execution-count">-</div>
            <div class="source-code">     CASE ( &#x27;a&#x27; )             ! arrivals calculation, binary</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">341</div>
            <div class="execution-count">48*</div>
            <div class="source-code">        CALL WriteArrivalsBinary( Pos%Rr, NRz_per_range, Pos%NRr, Beam%RunType( 4 : 4 ) )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">342</div>
            <div class="execution-count">-</div>
            <div class="source-code">     END SELECT</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">343</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">344</div>
            <div class="execution-count">-</div>
            <div class="source-code">  END DO SourceDepth</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">345</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">346</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! Display run time</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">347</div>
            <div class="execution-count">28</div>
            <div class="source-code">  CALL CPU_TIME( Tstop )</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">348</div>
            <div class="execution-count">28</div>
            <div class="source-code">  WRITE( PRTFile, &quot;( /, &#x27; CPU Time = &#x27;, G15.3, &#x27;s&#x27; )&quot; ) Tstop - Tstart</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">349</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">350</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! close all files</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">351</div>
            <div class="execution-count">8</div>
            <div class="source-code">  SELECT CASE ( Beam%RunType( 1 : 1 ) )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">352</div>
            <div class="execution-count">-</div>
            <div class="source-code">  CASE ( &#x27;C&#x27;, &#x27;S&#x27;, &#x27;I&#x27; )      ! TL calculation</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">353</div>
            <div class="execution-count">8</div>
            <div class="source-code">     CLOSE( SHDFile )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">354</div>
            <div class="execution-count">-</div>
            <div class="source-code">  CASE ( &#x27;A&#x27;, &#x27;a&#x27; )           ! arrivals calculation</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">355</div>
            <div class="execution-count">12</div>
            <div class="source-code">     CLOSE( ARRFile )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">356</div>
            <div class="execution-count">-</div>
            <div class="source-code">  CASE ( &#x27;R&#x27;, &#x27;E&#x27; )                ! ray trace</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">357</div>
            <div class="execution-count">28</div>
            <div class="source-code">     CLOSE( RAYFile )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">358</div>
            <div class="execution-count">-</div>
            <div class="source-code">  END SELECT</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">359</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line executed">
            <div class="line-number">360</div>
            <div class="execution-count">28</div>
            <div class="source-code">  CLOSE( PRTFile )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">361</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line executed">
            <div class="line-number">362</div>
            <div class="execution-count">28</div>
            <div class="source-code">END SUBROUTINE BellhopCore</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">363</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">364</div>
            <div class="execution-count">-</div>
            <div class="source-code">! **********************************************************************!</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">365</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">366</div>
            <div class="execution-count">115880*</div>
            <div class="source-code">COMPLEX (KIND=8 ) FUNCTION PickEpsilon( BeamType, omega, c, gradc, alpha, Dalpha, rLoop, EpsMultiplier )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">367</div>
            <div class="execution-count">-</div>
            <div class="source-code">!! Picks the optimum value for epsilon</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">368</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">369</div>
            <div class="execution-count">-</div>
            <div class="source-code">  REAL      (KIND=8), INTENT( IN  ) :: omega, c, gradc( 2 ) ! angular frequency, sound speed and gradient</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">370</div>
            <div class="execution-count">-</div>
            <div class="source-code">  REAL      (KIND=8), INTENT( IN  ) :: alpha, Dalpha        ! angular spacing for ray fan</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">371</div>
            <div class="execution-count">-</div>
            <div class="source-code">  REAL      (KIND=8), INTENT( IN  ) :: epsMultiplier, Rloop ! multiplier to manually adjust result, loop range</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">372</div>
            <div class="execution-count">-</div>
            <div class="source-code">  CHARACTER (LEN= 2), INTENT( IN  ) :: BeamType</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">373</div>
            <div class="execution-count">-</div>
            <div class="source-code">  LOGICAL, SAVE      :: INIFlag = .TRUE.</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">374</div>
            <div class="execution-count">-</div>
            <div class="source-code">  REAL      (KIND=8) :: HalfWidth</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">375</div>
            <div class="execution-count">-</div>
            <div class="source-code">  REAL      (KIND=8) :: cz</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">376</div>
            <div class="execution-count">-</div>
            <div class="source-code">  COMPLEX   (KIND=8) :: epsilonOpt</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">377</div>
            <div class="execution-count">-</div>
            <div class="source-code">  CHARACTER (LEN=40) :: TAG</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">378</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">379</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! LP: BUG: Multiple codepaths do not set epsilonOpt, leads to UB</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">380</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">381</div>
            <div class="execution-count">#####</div>
            <div class="source-code">  SELECT CASE ( BeamType( 1 : 1 ) )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">382</div>
            <div class="execution-count">-</div>
            <div class="source-code">  CASE ( &#x27;C&#x27;, &#x27;R&#x27; )</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">383</div>
            <div class="execution-count">#####</div>
            <div class="source-code">     TAG    = &#x27;Paraxial beams&#x27;</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">384</div>
            <div class="execution-count">#####</div>
            <div class="source-code">     SELECT CASE ( BeamType( 2 : 2 ) )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">385</div>
            <div class="execution-count">-</div>
            <div class="source-code">     CASE ( &#x27;F&#x27; )</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">386</div>
            <div class="execution-count">#####</div>
            <div class="source-code">        TAG        = &#x27;Space filling beams&#x27;</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">387</div>
            <div class="execution-count">#####</div>
            <div class="source-code">        halfwidth  = 2.0 / ( ( omega / c ) * Dalpha )</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">388</div>
            <div class="execution-count">#####</div>
            <div class="source-code">        epsilonOpt = i * 0.5 * omega * halfwidth ** 2</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">389</div>
            <div class="execution-count">-</div>
            <div class="source-code">     CASE ( &#x27;M&#x27; )</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">390</div>
            <div class="execution-count">#####</div>
            <div class="source-code">        TAG        = &#x27;Minimum width beams&#x27;</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">391</div>
            <div class="execution-count">#####</div>
            <div class="source-code">        halfwidth  = SQRT( 2.0 * c * 1000.0 * rLoop / omega )</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">392</div>
            <div class="execution-count">#####</div>
            <div class="source-code">        epsilonOpt = i * 0.5 * omega * halfwidth ** 2</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">393</div>
            <div class="execution-count">-</div>
            <div class="source-code">     CASE ( &#x27;W&#x27; )</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">394</div>
            <div class="execution-count">#####</div>
            <div class="source-code">        TAG       = &#x27;WKB beams&#x27;</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">395</div>
            <div class="execution-count">#####</div>
            <div class="source-code">        halfwidth = HUGE( halfwidth )</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">396</div>
            <div class="execution-count">#####</div>
            <div class="source-code">        cz        = gradc( 2 )</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">397</div>
            <div class="execution-count">#####</div>
            <div class="source-code">        IF ( cz == 0.0 ) THEN</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">398</div>
            <div class="execution-count">#####</div>
            <div class="source-code">           epsilonOpt = 1.0D10</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">399</div>
            <div class="execution-count">-</div>
            <div class="source-code">        ELSE</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">400</div>
            <div class="execution-count">#####</div>
            <div class="source-code">           epsilonOpt = ( -SIN( alpha ) / COS( alpha ** 2 ) ) * c * c / cz</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">401</div>
            <div class="execution-count">-</div>
            <div class="source-code">        ENDIF</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">402</div>
            <div class="execution-count">-</div>
            <div class="source-code">     END SELECT</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">403</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">404</div>
            <div class="execution-count">-</div>
            <div class="source-code">  CASE ( &#x27;G&#x27;, &#x27;g&#x27; ) ! LP: BUG: Missing ^</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">405</div>
            <div class="execution-count">111280</div>
            <div class="source-code">     TAG        = &#x27;Geometric hat beams&#x27;</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">406</div>
            <div class="execution-count">111280</div>
            <div class="source-code">     halfwidth  = 2.0 / ( ( omega / c ) * Dalpha )</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">407</div>
            <div class="execution-count">111280</div>
            <div class="source-code">     epsilonOpt = i * 0.5 * omega * halfwidth ** 2</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">408</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">409</div>
            <div class="execution-count">-</div>
            <div class="source-code">  CASE ( &#x27;B&#x27; )</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">410</div>
            <div class="execution-count">4600</div>
            <div class="source-code">     TAG        = &#x27;Geometric Gaussian beams&#x27;</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">411</div>
            <div class="execution-count">4600</div>
            <div class="source-code">     halfwidth  = 2.0 / ( ( omega / c ) * Dalpha )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">412</div>
            <div class="execution-count">4600*</div>
            <div class="source-code">     epsilonOpt = i * 0.5 * omega * halfwidth ** 2</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">413</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">414</div>
            <div class="execution-count">-</div>
            <div class="source-code">  CASE ( &#x27;b&#x27; )</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">415</div>
            <div class="execution-count">#####</div>
            <div class="source-code">     CALL ERROUT( &#x27;BELLHOP&#x27;, &#x27;Geo Gaussian beams in ray-centered coords. not implemented in BELLHOP&#x27; )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">416</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">417</div>
            <div class="execution-count">-</div>
            <div class="source-code">  CASE ( &#x27;S&#x27; )</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">418</div>
            <div class="execution-count">#####</div>
            <div class="source-code">     TAG        = &#x27;Simple Gaussian beams&#x27;</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">419</div>
            <div class="execution-count">#####</div>
            <div class="source-code">     halfwidth  = 2.0 / ( ( omega / c ) * Dalpha )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">420</div>
            <div class="execution-count">115880*</div>
            <div class="source-code">     epsilonOpt = i * 0.5 * omega * halfwidth ** 2</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">421</div>
            <div class="execution-count">-</div>
            <div class="source-code">  END SELECT</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">422</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line executed">
            <div class="line-number">423</div>
            <div class="execution-count">115880</div>
            <div class="source-code">  PickEpsilon = EpsMultiplier * epsilonOpt</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">424</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">425</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! On first call write info to prt file</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">426</div>
            <div class="execution-count">115880</div>
            <div class="source-code">  IF ( INIFlag ) THEN</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">427</div>
            <div class="execution-count">25</div>
            <div class="source-code">     WRITE( PRTFile, * )</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">428</div>
            <div class="execution-count">25</div>
            <div class="source-code">     WRITE( PRTFile, * ) TAG</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">429</div>
            <div class="execution-count">25</div>
            <div class="source-code">     WRITE( PRTFile, * ) &#x27;halfwidth  = &#x27;, halfwidth</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">430</div>
            <div class="execution-count">25</div>
            <div class="source-code">     WRITE( PRTFile, * ) &#x27;epsilonOpt = &#x27;, epsilonOpt</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">431</div>
            <div class="execution-count">25</div>
            <div class="source-code">     WRITE( PRTFile, * ) &#x27;EpsMult    = &#x27;, EpsMultiplier</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">432</div>
            <div class="execution-count">25</div>
            <div class="source-code">     WRITE( PRTFile, * )</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">433</div>
            <div class="execution-count">25</div>
            <div class="source-code">     INIFlag = .FALSE.</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">434</div>
            <div class="execution-count">-</div>
            <div class="source-code">  END IF</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">435</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line executed">
            <div class="line-number">436</div>
            <div class="execution-count">115880</div>
            <div class="source-code">END FUNCTION PickEpsilon</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">437</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">438</div>
            <div class="execution-count">-</div>
            <div class="source-code">! **********************************************************************!</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">439</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line executed">
            <div class="line-number">440</div>
            <div class="execution-count">232060</div>
            <div class="source-code">SUBROUTINE TraceRay2D( xs, alpha, Amp0 )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">441</div>
            <div class="execution-count">-</div>
            <div class="source-code">!! Traces the beam corresponding to a particular take-off angle</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">442</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">443</div>
            <div class="execution-count">-</div>
            <div class="source-code">  USE Step</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">444</div>
            <div class="execution-count">-</div>
            <div class="source-code">  USE WriteRay</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">445</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">446</div>
            <div class="execution-count">-</div>
            <div class="source-code">  REAL     (KIND=8), INTENT( IN ) :: xs( 2 )      ! x-y coordinate of the source</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">447</div>
            <div class="execution-count">-</div>
            <div class="source-code">  REAL     (KIND=8), INTENT( IN ) :: alpha, Amp0  ! initial angle, amplitude</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">448</div>
            <div class="execution-count">-</div>
            <div class="source-code">  INTEGER           :: is, is1                    ! index for a step along the ray</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">449</div>
            <div class="execution-count">-</div>
            <div class="source-code">  REAL     (KIND=8) :: c, cimag, gradc( 2 ), crr, crz, czz, rho</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">450</div>
            <div class="execution-count">-</div>
            <div class="source-code">  REAL     (KIND=8) :: dEndTop( 2 ), dEndBot( 2 ), TopnInt( 2 ), BotnInt( 2 ), ToptInt( 2 ), BottInt( 2 )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">451</div>
            <div class="execution-count">-</div>
            <div class="source-code">  REAL     (KIND=8) :: DistBegTop, DistEndTop, DistBegBot, DistEndBot ! Distances from ray beginning, end to top and bottom</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">452</div>
            <div class="execution-count">-</div>
            <div class="source-code">  REAL     (KIND=8) :: sss</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">453</div>
            <div class="execution-count">-</div>
            <div class="source-code">  REAL     (KIND=8) :: tinit( 2 )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">454</div>
            <div class="execution-count">-</div>
            <div class="source-code">  LOGICAL           :: topRefl, botRefl</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">455</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">456</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! Initial conditions</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">457</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">458</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! LP: This initialization was missing (only done once globally). In some cases</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">459</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! (a source on a boundary), in conjunction with other subtle issues, the</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">460</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! missing initialization caused the initial state of one ray to be dependent</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">461</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! on the final state of the previous ray, which is obviously non-physical.</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">462</div>
            <div class="execution-count">116030</div>
            <div class="source-code">  iSegz = 1</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">463</div>
            <div class="execution-count">116030</div>
            <div class="source-code">  iSegr = 1</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">464</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line executed">
            <div class="line-number">465</div>
            <div class="execution-count">116030</div>
            <div class="source-code">  iSmallStepCtr = 0</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">466</div>
            <div class="execution-count">348090</div>
            <div class="source-code">  tinit = [ COS( alpha ), SIN( alpha ) ]</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">467</div>
            <div class="execution-count">116030</div>
            <div class="source-code">  CALL EvaluateSSP( xs, tinit, c, cimag, gradc, crr, crz, czz, rho, freq, &#x27;TAB&#x27; )</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">468</div>
            <div class="execution-count">116030</div>
            <div class="source-code">  ray2D( 1 )%c         = c</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">469</div>
            <div class="execution-count">348090</div>
            <div class="source-code">  ray2D( 1 )%x         = xs</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">470</div>
            <div class="execution-count">348090</div>
            <div class="source-code">  ray2D( 1 )%t         = tinit / c</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">471</div>
            <div class="execution-count">348090</div>
            <div class="source-code">  ray2D( 1 )%p         = [ 1.0, 0.0 ]</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">472</div>
            <div class="execution-count">348090</div>
            <div class="source-code">  ray2D( 1 )%q         = [ 0.0, 1.0 ]</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">473</div>
            <div class="execution-count">116030</div>
            <div class="source-code">  ray2D( 1 )%tau       = 0.0</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">474</div>
            <div class="execution-count">116030</div>
            <div class="source-code">  ray2D( 1 )%Amp       = Amp0</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">475</div>
            <div class="execution-count">116030</div>
            <div class="source-code">  ray2D( 1 )%Phase     = 0.0</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">476</div>
            <div class="execution-count">116030</div>
            <div class="source-code">  ray2D( 1 )%NumTopBnc = 0</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">477</div>
            <div class="execution-count">116030</div>
            <div class="source-code">  ray2D( 1 )%NumBotBnc = 0</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">478</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">479</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! second component of qv is not used in geometric beam tracing</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">480</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! set I.C. to 0 in hopes of saving run time</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">481</div>
            <div class="execution-count">338890</div>
            <div class="source-code">  IF ( Beam%RunType( 2 : 2 ) == &#x27;G&#x27; ) ray2D( 1 )%q = [ 0.0, 0.0 ]</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">482</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line executed">
            <div class="line-number">483</div>
            <div class="execution-count">116030</div>
            <div class="source-code">  CALL GetTopSeg( xs( 1 ), ray2D( 1 )%t( 1 ) )   ! identify the top    segment above the source</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">484</div>
            <div class="execution-count">116030</div>
            <div class="source-code">  CALL GetBotSeg( xs( 1 ), ray2D( 1 )%t( 1 ) )   ! identify the bottom segment below the source</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">485</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">486</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! convert range-dependent geoacoustic parameters from user to program units</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">487</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! compiler is not accepting the copy of the whole structure at once ...</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">488</div>
            <div class="execution-count">116030</div>
            <div class="source-code">  IF ( atiType( 2 : 2 ) == &#x27;L&#x27; ) THEN</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">489</div>
            <div class="execution-count">#####</div>
            <div class="source-code">     Bdry%Top%HS%cp  = Top( IsegTop )%HS%cp   ! grab the geoacoustic info for the new segment</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">490</div>
            <div class="execution-count">#####</div>
            <div class="source-code">     Bdry%Top%HS%cs  = Top( IsegTop )%HS%cs</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">491</div>
            <div class="execution-count">#####</div>
            <div class="source-code">     Bdry%Top%HS%rho = Top( IsegTop )%HS%rho</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">492</div>
            <div class="execution-count">-</div>
            <div class="source-code">  END IF</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">493</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line executed">
            <div class="line-number">494</div>
            <div class="execution-count">116030</div>
            <div class="source-code">  IF ( btyType( 2 : 2 ) == &#x27;L&#x27; ) THEN</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">495</div>
            <div class="execution-count">#####</div>
            <div class="source-code">     Bdry%Bot%HS%cp  = Bot( IsegBot )%HS%cp</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">496</div>
            <div class="execution-count">#####</div>
            <div class="source-code">     Bdry%Bot%HS%cs  = Bot( IsegBot )%HS%cs</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">497</div>
            <div class="execution-count">#####</div>
            <div class="source-code">     Bdry%Bot%HS%rho = Bot( IsegBot )%HS%rho</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">498</div>
            <div class="execution-count">-</div>
            <div class="source-code">  END IF</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">499</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">500</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! Trace the beam (note that Reflect alters the step index, is)</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">501</div>
            <div class="execution-count">116030</div>
            <div class="source-code">  is = 0</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">502</div>
            <div class="execution-count">#####</div>
            <div class="source-code">  CALL Distances2D( ray2D( 1 )%x, Top( IsegTop )%x, Bot( IsegBot )%x, dEndTop,    dEndBot,  &amp;</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">503</div>
            <div class="execution-count">116030*</div>
            <div class="source-code">       Top( IsegTop )%n, Bot( IsegBot )%n, DistBegTop, DistBegBot )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">504</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line executed">
            <div class="line-number">505</div>
            <div class="execution-count">116030</div>
            <div class="source-code">  IF ( DistBegTop &lt;= 0 .OR. DistBegBot &lt;= 0 ) THEN</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">506</div>
            <div class="execution-count">#####</div>
            <div class="source-code">     Beam%Nsteps = 1</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">507</div>
            <div class="execution-count">#####</div>
            <div class="source-code">     WRITE( PRTFile, * ) &#x27;Terminating the ray trace because the source is on or outside the boundaries&#x27;</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">508</div>
            <div class="execution-count">#####</div>
            <div class="source-code">     RETURN       ! source must be within the medium</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">509</div>
            <div class="execution-count">-</div>
            <div class="source-code">  END IF</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">510</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">511</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! LP: Changed from loop istep to MaxN-1, as is will hit MaxN-3 first.</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">512</div>
            <div class="execution-count">29146583</div>
            <div class="source-code">  Stepping: DO WHILE ( .TRUE. )</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">513</div>
            <div class="execution-count">29262613</div>
            <div class="source-code">     is  = is + 1</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">514</div>
            <div class="execution-count">29262613</div>
            <div class="source-code">     is1 = is + 1</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">515</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">516</div>
            <div class="execution-count">58525226*</div>
            <div class="source-code">     CALL Step2D( ray2D( is ), ray2D( is1 ),  &amp;</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">517</div>
            <div class="execution-count">-</div>
            <div class="source-code">          topRefl, botRefl, &amp;</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">518</div>
            <div class="execution-count">#####</div>
            <div class="source-code">          Top( IsegTop )%x, Top( IsegTop )%n, &amp;</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">519</div>
            <div class="execution-count">87787839*</div>
            <div class="source-code">          Bot( IsegBot )%x, Bot( IsegBot )%n )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">520</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">521</div>
            <div class="execution-count">-</div>
            <div class="source-code">     ! New altimetry segment?</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">522</div>
            <div class="execution-count">29262613*</div>
            <div class="source-code">     IF (        ray2D( is1 )%x( 1 )  &lt; rTopSeg( 1 ) &amp;</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">523</div>
            <div class="execution-count">58525226*</div>
            <div class="source-code">          .OR. ( ray2D( is1 )%x( 1 ) == rTopSeg( 1 ) .AND. ray2D( is1 )%t( 1 ) &lt;  0.0 ) &amp;</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">524</div>
            <div class="execution-count">29262613*</div>
            <div class="source-code">          .OR.   ray2D( is1 )%x( 1 )  &gt; rTopSeg( 2 ) &amp;</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">525</div>
            <div class="execution-count">146313065*</div>
            <div class="source-code">          .OR. ( ray2D( is1 )%x( 1 ) == rTopSeg( 2 ) .AND. ray2D( is1 )%t( 1 ) &gt;= 0.0 )) THEN</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">526</div>
            <div class="execution-count">#####</div>
            <div class="source-code">        CALL GetTopSeg( ray2D( is1 )%x( 1 ), ray2D( is1 )%t( 1 ) )</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">527</div>
            <div class="execution-count">#####</div>
            <div class="source-code">        IF ( atiType( 2 : 2 ) == &#x27;L&#x27; ) THEN</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">528</div>
            <div class="execution-count">#####</div>
            <div class="source-code">           Bdry%Top%HS%cp  = Top( IsegTop )%HS%cp   ! grab the geoacoustic info for the new segment</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">529</div>
            <div class="execution-count">#####</div>
            <div class="source-code">           Bdry%Top%HS%cs  = Top( IsegTop )%HS%cs</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">530</div>
            <div class="execution-count">#####</div>
            <div class="source-code">           Bdry%Top%HS%rho = Top( IsegTop )%HS%rho</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">531</div>
            <div class="execution-count">-</div>
            <div class="source-code">        END IF</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">532</div>
            <div class="execution-count">-</div>
            <div class="source-code">     END IF</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">533</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">534</div>
            <div class="execution-count">-</div>
            <div class="source-code">     ! New bathymetry segment?</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">535</div>
            <div class="execution-count">29262613*</div>
            <div class="source-code">     IF (        ray2D( is1 )%x( 1 )  &lt; rBotSeg( 1 ) &amp;</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">536</div>
            <div class="execution-count">58525226*</div>
            <div class="source-code">          .OR. ( ray2D( is1 )%x( 1 ) == rBotSeg( 1 ) .AND. ray2D( is1 )%t( 1 ) &lt;  0.0 ) &amp;</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">537</div>
            <div class="execution-count">29262613*</div>
            <div class="source-code">          .OR.   ray2D( is1 )%x( 1 )  &gt; rBotSeg( 2 ) &amp;</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">538</div>
            <div class="execution-count">146313065*</div>
            <div class="source-code">          .OR. ( ray2D( is1 )%x( 1 ) == rBotSeg( 2 ) .AND. ray2D( is1 )%t( 1 ) &gt;= 0.0 )) THEN</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">539</div>
            <div class="execution-count">24353*</div>
            <div class="source-code">        CALL GetBotSeg( ray2D( is1 )%x( 1 ), ray2D( is1 )%t( 1 ) )</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">540</div>
            <div class="execution-count">24353</div>
            <div class="source-code">        IF ( btyType( 2 : 2 ) == &#x27;L&#x27; ) THEN</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">541</div>
            <div class="execution-count">#####</div>
            <div class="source-code">           Bdry%Bot%HS%cp  = Bot( IsegBot )%HS%cp   ! grab the geoacoustic info for the new segment</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">542</div>
            <div class="execution-count">#####</div>
            <div class="source-code">           Bdry%Bot%HS%cs  = Bot( IsegBot )%HS%cs</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">543</div>
            <div class="execution-count">#####</div>
            <div class="source-code">           Bdry%Bot%HS%rho = Bot( IsegBot )%HS%rho</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">544</div>
            <div class="execution-count">-</div>
            <div class="source-code">        END IF</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">545</div>
            <div class="execution-count">-</div>
            <div class="source-code">     END IF</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">546</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">547</div>
            <div class="execution-count">-</div>
            <div class="source-code">     ! Reflections?</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">548</div>
            <div class="execution-count">-</div>
            <div class="source-code">     ! Tests that ray at step is is inside, and ray at step is+1 is outside</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">549</div>
            <div class="execution-count">-</div>
            <div class="source-code">     ! to detect only a crossing from inside to outside</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">550</div>
            <div class="execution-count">-</div>
            <div class="source-code">     ! DistBeg is the distance at step is,   which is saved</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">551</div>
            <div class="execution-count">-</div>
            <div class="source-code">     ! DistEnd is the distance at step is+1, which needs to be calculated</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">552</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">553</div>
            <div class="execution-count">58525226*</div>
            <div class="source-code">     CALL Distances2D( ray2D( is1 )%x, Top( IsegTop )%x, Bot( IsegBot )%x, dEndTop,    dEndBot,  &amp;</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">554</div>
            <div class="execution-count">87787839*</div>
            <div class="source-code">          Top( IsegTop )%n, Bot( IsegBot )%n, DistEndTop, DistEndBot )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">555</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line executed">
            <div class="line-number">556</div>
            <div class="execution-count">29262613</div>
            <div class="source-code">     IF      ( topRefl ) THEN</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">557</div>
            <div class="execution-count">-</div>
            <div class="source-code">        ! WRITE( PRTFile, * ) &#x27;Top reflecting&#x27;</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">558</div>
            <div class="execution-count">603871</div>
            <div class="source-code">        IF ( atiType == &#x27;C&#x27; ) THEN</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">559</div>
            <div class="execution-count">#####</div>
            <div class="source-code">           sss     = DOT_PRODUCT( dEndTop, Top( IsegTop )%t ) / Top( IsegTop )%Len   ! proportional distance along segment</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">560</div>
            <div class="execution-count">#####</div>
            <div class="source-code">           TopnInt = ( 1 - sss ) * Top( IsegTop )%Noden + sss * Top( 1 + IsegTop )%Noden</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">561</div>
            <div class="execution-count">#####</div>
            <div class="source-code">           ToptInt = ( 1 - sss ) * Top( IsegTop )%Nodet + sss * Top( 1 + IsegTop )%Nodet</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">562</div>
            <div class="execution-count">-</div>
            <div class="source-code">        ELSE</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">563</div>
            <div class="execution-count">1811613*</div>
            <div class="source-code">           TopnInt = Top( IsegTop )%n   ! normal is constant in a segment</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">564</div>
            <div class="execution-count">1811613*</div>
            <div class="source-code">           ToptInt = Top( IsegTop )%t</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">565</div>
            <div class="execution-count">-</div>
            <div class="source-code">        END IF</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">566</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">567</div>
            <div class="execution-count">603871*</div>
            <div class="source-code">        CALL Reflect2D( is, Bdry%Top%HS, &#x27;TOP&#x27;, ToptInt, TopnInt, Top( IsegTop )%kappa, RTop, NTopPTS )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">568</div>
            <div class="execution-count">603871*</div>
            <div class="source-code">        ray2D( is + 1 )%NumTopBnc = ray2D( is )%NumTopBnc + 1</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">569</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">570</div>
            <div class="execution-count">1207742*</div>
            <div class="source-code">        CALL Distances2D( ray2D( is + 1 )%x, Top( IsegTop )%x, Bot( IsegBot )%x, dEndTop,    dEndBot,  &amp;</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">571</div>
            <div class="execution-count">1811613*</div>
            <div class="source-code">             Top( IsegTop )%n, Bot( IsegBot )%n, DistEndTop, DistEndBot )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">572</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line executed">
            <div class="line-number">573</div>
            <div class="execution-count">28658742</div>
            <div class="source-code">     ELSE IF ( botRefl ) THEN</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">574</div>
            <div class="execution-count">-</div>
            <div class="source-code">        ! WRITE( PRTFile, * ) &#x27;Bottom reflecting&#x27;</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">575</div>
            <div class="execution-count">640560</div>
            <div class="source-code">        IF ( btyType == &#x27;C&#x27; ) THEN</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">576</div>
            <div class="execution-count">#####</div>
            <div class="source-code">           sss     = DOT_PRODUCT( dEndBot, Bot( IsegBot )%t ) / Bot( IsegBot )%Len   ! proportional distance along segment</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">577</div>
            <div class="execution-count">#####</div>
            <div class="source-code">           BotnInt = ( 1 - sss ) * Bot( IsegBot )%Noden + sss * Bot( 1 + IsegBot )%Noden</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">578</div>
            <div class="execution-count">#####</div>
            <div class="source-code">           BottInt = ( 1 - sss ) * Bot( IsegBot )%Nodet + sss * Bot( 1 + IsegBot )%Nodet</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">579</div>
            <div class="execution-count">-</div>
            <div class="source-code">        ELSE</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">580</div>
            <div class="execution-count">1921680*</div>
            <div class="source-code">           BotnInt = Bot( IsegBot )%n   ! normal is constant in a segment</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">581</div>
            <div class="execution-count">1921680*</div>
            <div class="source-code">           BottInt = Bot( IsegBot )%t</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">582</div>
            <div class="execution-count">-</div>
            <div class="source-code">        END IF</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">583</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">584</div>
            <div class="execution-count">640560*</div>
            <div class="source-code">        CALL Reflect2D( is, Bdry%Bot%HS, &#x27;BOT&#x27;, BottInt, BotnInt, Bot( IsegBot )%kappa, RBot, NBotPTS )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">585</div>
            <div class="execution-count">640560*</div>
            <div class="source-code">        ray2D( is + 1 )%NumBotBnc = ray2D( is )%NumBotBnc + 1</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">586</div>
            <div class="execution-count">1281120*</div>
            <div class="source-code">        CALL Distances2D( ray2D( is + 1 )%x, Top( IsegTop )%x, Bot( IsegBot )%x, dEndTop,    dEndBot, &amp;</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">587</div>
            <div class="execution-count">1921680*</div>
            <div class="source-code">             Top( IsegTop )%n, Bot( IsegBot )%n, DistEndTop, DistEndBot )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">588</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">589</div>
            <div class="execution-count">-</div>
            <div class="source-code">     END IF</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">590</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">591</div>
            <div class="execution-count">-</div>
            <div class="source-code">     ! Has the ray left the box, lost its energy, escaped the boundaries, or exceeded storage limit?</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">592</div>
            <div class="execution-count">-</div>
            <div class="source-code">     ! There is a test here for when two adjacent ray points are outside the boundaries</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">593</div>
            <div class="execution-count">-</div>
            <div class="source-code">     ! BELLHOP3D handles this differently using a counter-limit for really small steps.</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">594</div>
            <div class="execution-count">29262613*</div>
            <div class="source-code">     IF ( ABS( ray2D( is + 1 )%x( 1 ) ) &gt;= Beam%Box%r .OR. &amp;</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">595</div>
            <div class="execution-count">58525226*</div>
            <div class="source-code">          ABS( ray2D( is + 1 )%x( 2 ) ) &gt;= Beam%Box%z .OR. ray2D( is + 1 )%Amp &lt; 0.005 .OR. &amp;</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">596</div>
            <div class="execution-count">117050452</div>
            <div class="source-code">          ( DistBegTop &lt; 0.0 .AND. DistEndTop &lt; 0.0 ) .OR. &amp;</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">597</div>
            <div class="execution-count">-</div>
            <div class="source-code">          ( DistBegBot &lt; 0.0 .AND. DistEndBot &lt; 0.0 ) ) THEN</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">598</div>
            <div class="execution-count">-</div>
            <div class="source-code">          ! ray2D( is + 1 )%t( 1 ) &lt; 0 ) THEN ! this last test kills off a backward traveling ray</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">599</div>
            <div class="execution-count">116024</div>
            <div class="source-code">        Beam%Nsteps = is + 1</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">600</div>
            <div class="execution-count">116024</div>
            <div class="source-code">        EXIT Stepping</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">601</div>
            <div class="execution-count">29146589</div>
            <div class="source-code">     ELSE IF ( is &gt;= MaxN - 3 ) THEN</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">602</div>
            <div class="execution-count">6</div>
            <div class="source-code">        WRITE( PRTFile, * ) &#x27;Warning in TraceRay2D : Insufficient storage for ray trajectory&#x27;</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">603</div>
            <div class="execution-count">6</div>
            <div class="source-code">        Beam%Nsteps = is</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">604</div>
            <div class="execution-count">6</div>
            <div class="source-code">        EXIT Stepping</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">605</div>
            <div class="execution-count">-</div>
            <div class="source-code">     END IF</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">606</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line executed">
            <div class="line-number">607</div>
            <div class="execution-count">29146583</div>
            <div class="source-code">     DistBegTop = DistEndTop</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">608</div>
            <div class="execution-count">29146583</div>
            <div class="source-code">     DistBegBot = DistEndBot</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">609</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">610</div>
            <div class="execution-count">-</div>
            <div class="source-code">  END DO Stepping</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">611</div>
            <div class="execution-count">-</div>
            <div class="source-code">END SUBROUTINE TraceRay2D</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">612</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">613</div>
            <div class="execution-count">-</div>
            <div class="source-code">! **********************************************************************!</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">614</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line executed">
            <div class="line-number">615</div>
            <div class="execution-count">30623074</div>
            <div class="source-code">SUBROUTINE Distances2D( rayx, Topx, Botx, dTop, dBot, Topn, Botn, DistTop, DistBot )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">616</div>
            <div class="execution-count">-</div>
            <div class="source-code">!! Calculates the distances to the boundaries</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">617</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">618</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! Formula differs from JKPS because code uses outward pointing normals</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">619</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">620</div>
            <div class="execution-count">-</div>
            <div class="source-code">  REAL (KIND=8), INTENT( IN  ) :: rayx( 2 )              ! ray coordinate</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">621</div>
            <div class="execution-count">-</div>
            <div class="source-code">  REAL (KIND=8), INTENT( IN  ) :: Topx( 2 ), Botx( 2 )   ! top, bottom coordinate</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">622</div>
            <div class="execution-count">-</div>
            <div class="source-code">  REAL (KIND=8), INTENT( IN  ) :: Topn( 2 ), Botn( 2 )   ! top, bottom normal vector (outward)</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">623</div>
            <div class="execution-count">-</div>
            <div class="source-code">  REAL (KIND=8), INTENT( OUT ) :: dTop( 2 ), dBot( 2 )   ! vector pointing from top, bottom bdry to ray</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">624</div>
            <div class="execution-count">-</div>
            <div class="source-code">  REAL (KIND=8), INTENT( OUT ) :: DistTop, DistBot       ! distance (normal to bdry) from the ray to top, bottom boundary</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">625</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line executed">
            <div class="line-number">626</div>
            <div class="execution-count">91869222</div>
            <div class="source-code">  dTop    = rayx - Topx  ! vector pointing from top    to ray</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">627</div>
            <div class="execution-count">91869222</div>
            <div class="source-code">  dBot    = rayx - Botx  ! vector pointing from bottom to ray</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">628</div>
            <div class="execution-count">91869222</div>
            <div class="source-code">  DistTop = -DOT_PRODUCT( Topn, dTop )</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">629</div>
            <div class="execution-count">91869222</div>
            <div class="source-code">  DistBot = -DOT_PRODUCT( Botn, dBot )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">630</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line executed">
            <div class="line-number">631</div>
            <div class="execution-count">30623074</div>
            <div class="source-code">END SUBROUTINE Distances2D</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">632</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">633</div>
            <div class="execution-count">-</div>
            <div class="source-code">! **********************************************************************!</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">634</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">635</div>
            <div class="execution-count">1244431*</div>
            <div class="source-code">SUBROUTINE Reflect2D( is, HS, BotTop, tBdry, nBdry, kappa, RefC, Npts )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">636</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">637</div>
            <div class="execution-count">-</div>
            <div class="source-code">  INTEGER,              INTENT( IN ) :: Npts</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">638</div>
            <div class="execution-count">-</div>
            <div class="source-code">  REAL     (KIND=8),    INTENT( IN ) :: tBdry( 2 ), nBdry( 2 )  ! Tangent and normal to the boundary</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">639</div>
            <div class="execution-count">-</div>
            <div class="source-code">  REAL     (KIND=8),    INTENT( IN ) :: kappa                   ! Boundary curvature</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">640</div>
            <div class="execution-count">-</div>
            <div class="source-code">  CHARACTER (LEN=3),    INTENT( IN ) :: BotTop                  ! Flag indicating bottom or top reflection</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">641</div>
            <div class="execution-count">-</div>
            <div class="source-code">  TYPE( HSInfo ),       INTENT( IN ) :: HS                      ! half-space properties</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">642</div>
            <div class="execution-count">-</div>
            <div class="source-code">  TYPE(ReflectionCoef), INTENT( IN ) :: RefC( NPts )            ! reflection coefficient</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">643</div>
            <div class="execution-count">-</div>
            <div class="source-code">  INTEGER,              INTENT( INOUT ) :: is</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">644</div>
            <div class="execution-count">-</div>
            <div class="source-code">  INTEGER           :: is1</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">645</div>
            <div class="execution-count">-</div>
            <div class="source-code">  REAL     (KIND=8) :: c, cimag, gradc( 2 ), crr, crz, czz, rho                  ! derivatives of sound speed</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">646</div>
            <div class="execution-count">-</div>
            <div class="source-code">  REAL     (KIND=8) :: RM, RN, Tg, Th, rayt( 2 ), rayn( 2 ), rayt_tilde( 2 ), rayn_tilde( 2 ), cnjump, csjump  ! for curvature change</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">647</div>
            <div class="execution-count">-</div>
            <div class="source-code">  REAL     (KIND=8) :: ck, co, si, cco, ssi, pdelta, rddelta, sddelta, theta_bot ! for beam shift</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">648</div>
            <div class="execution-count">-</div>
            <div class="source-code">  COMPLEX  (KIND=8) :: kx, kz, kzP, kzS, kzP2, kzS2, mu, f, g, y2, y4, Refl      ! for tabulated reflection coef.</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">649</div>
            <div class="execution-count">-</div>
            <div class="source-code">  COMPLEX  (KIND=8) :: ch, a, b, d, sb, delta, ddelta                            ! for beam shift</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">650</div>
            <div class="execution-count">-</div>
            <div class="source-code">  TYPE(ReflectionCoef) :: RInt</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">651</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line executed">
            <div class="line-number">652</div>
            <div class="execution-count">1244431</div>
            <div class="source-code">  is  = is + 1</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">653</div>
            <div class="execution-count">1244431</div>
            <div class="source-code">  is1 = is + 1</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">654</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">655</div>
            <div class="execution-count">3733293*</div>
            <div class="source-code">  Tg = DOT_PRODUCT( ray2D( is )%t, tBdry )  ! component of ray tangent, along boundary</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">656</div>
            <div class="execution-count">3733293*</div>
            <div class="source-code">  Th = DOT_PRODUCT( ray2D( is )%t, nBdry )  ! component of ray tangent, normal to boundary</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">657</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">658</div>
            <div class="execution-count">1244431*</div>
            <div class="source-code">  ray2D( is1 )%NumTopBnc = ray2D( is )%NumTopBnc</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">659</div>
            <div class="execution-count">1244431*</div>
            <div class="source-code">  ray2D( is1 )%NumBotBnc = ray2D( is )%NumBotBnc</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">660</div>
            <div class="execution-count">3733293*</div>
            <div class="source-code">  ray2D( is1 )%x         = ray2D( is )%x</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">661</div>
            <div class="execution-count">3733293*</div>
            <div class="source-code">  ray2D( is1 )%t         = ray2D( is )%t - 2.0 * Th * nBdry  ! changing the ray direction</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">662</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">663</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! Calculate the change in curvature</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">664</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! Based on formulas given by Muller, Geoph. J. R.A.S., 79 (1984).</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">665</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">666</div>
            <div class="execution-count">1244431*</div>
            <div class="source-code">  CALL EvaluateSSP( ray2D( is )%x, ray2D( is )%t, c, cimag, gradc, crr, crz, czz, rho, freq, &#x27;TAB&#x27; )   ! just to get c</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">667</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">668</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! incident unit ray tangent and normal</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">669</div>
            <div class="execution-count">3733293*</div>
            <div class="source-code">  rayt = c * ray2D( is )%t                              ! unit tangent to ray</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">670</div>
            <div class="execution-count">3733293</div>
            <div class="source-code">  rayn = [ -rayt( 2 ), rayt( 1 ) ]                      ! unit normal  to ray</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">671</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">672</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! reflected unit ray tangent and normal (the reflected tangent, normal system has a different orientation)</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">673</div>
            <div class="execution-count">3733293*</div>
            <div class="source-code">  rayt_tilde = c * ray2D( is1 )%t                       ! unit tangent to ray</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">674</div>
            <div class="execution-count">3733293</div>
            <div class="source-code">  rayn_tilde = -[ -rayt_tilde( 2 ), rayt_tilde( 1 ) ]   ! unit normal  to ray</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">675</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line executed">
            <div class="line-number">676</div>
            <div class="execution-count">1244431</div>
            <div class="source-code">  RN = 2 * kappa / c ** 2 / Th    ! boundary curvature correction</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">677</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">678</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! get the jumps (this could be simplified, e.g. jump in rayt is roughly 2 * Th * nbdry</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">679</div>
            <div class="execution-count">3733293</div>
            <div class="source-code">  cnjump = -DOT_PRODUCT( gradc, rayn_tilde - rayn )</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">680</div>
            <div class="execution-count">3733293</div>
            <div class="source-code">  csjump = -DOT_PRODUCT( gradc, rayt_tilde - rayt )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">681</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line executed">
            <div class="line-number">682</div>
            <div class="execution-count">1244431</div>
            <div class="source-code">  IF ( BotTop == &#x27;TOP&#x27; ) THEN</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">683</div>
            <div class="execution-count">603871</div>
            <div class="source-code">     cnjump = -cnjump   ! this is because the (t,n) system of the top boundary has a different sense to the bottom boundary</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">684</div>
            <div class="execution-count">603871</div>
            <div class="source-code">     RN     = -RN</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">685</div>
            <div class="execution-count">-</div>
            <div class="source-code">  END IF</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">686</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line executed">
            <div class="line-number">687</div>
            <div class="execution-count">1244431</div>
            <div class="source-code">  RM = Tg / Th   ! this is tan( alpha ) where alpha is the angle of incidence</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">688</div>
            <div class="execution-count">1244431</div>
            <div class="source-code">  RN = RN + RM * ( 2 * cnjump - RM * csjump ) / c ** 2</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">689</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">690</div>
            <div class="execution-count">#####</div>
            <div class="source-code">  SELECT CASE ( Beam%Type( 3 : 3 ) )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">691</div>
            <div class="execution-count">-</div>
            <div class="source-code">  CASE ( &#x27;D&#x27; )</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">692</div>
            <div class="execution-count">#####</div>
            <div class="source-code">     RN = 2.0 * RN</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">693</div>
            <div class="execution-count">-</div>
            <div class="source-code">  CASE ( &#x27;Z&#x27; )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">694</div>
            <div class="execution-count">1244431*</div>
            <div class="source-code">     RN = 0.0</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">695</div>
            <div class="execution-count">-</div>
            <div class="source-code">  END SELECT</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">696</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">697</div>
            <div class="execution-count">1244431*</div>
            <div class="source-code">  ray2D( is1 )%c   = c</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">698</div>
            <div class="execution-count">1244431*</div>
            <div class="source-code">  ray2D( is1 )%tau = ray2D( is )%tau</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">699</div>
            <div class="execution-count">3733293*</div>
            <div class="source-code">  ray2D( is1 )%p   = ray2D( is )%p + ray2D( is )%q * RN</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">700</div>
            <div class="execution-count">3733293*</div>
            <div class="source-code">  ray2D( is1 )%q   = ray2D( is )%q</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">701</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">702</div>
            <div class="execution-count">-</div>
            <div class="source-code">  ! account for phase change</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">703</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">704</div>
            <div class="execution-count">#####</div>
            <div class="source-code">  SELECT CASE ( HS%BC )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">705</div>
            <div class="execution-count">-</div>
            <div class="source-code">  CASE ( &#x27;R&#x27; )                 ! rigid</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">706</div>
            <div class="execution-count">#####</div>
            <div class="source-code">     ray2D( is1 )%Amp   = ray2D( is )%Amp</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">707</div>
            <div class="execution-count">#####</div>
            <div class="source-code">     ray2D( is1 )%Phase = ray2D( is )%Phase</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">708</div>
            <div class="execution-count">-</div>
            <div class="source-code">  CASE ( &#x27;V&#x27; )                 ! vacuum</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">709</div>
            <div class="execution-count">603364*</div>
            <div class="source-code">     ray2D( is1 )%Amp   = ray2D( is )%Amp</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">710</div>
            <div class="execution-count">603364*</div>
            <div class="source-code">     ray2D( is1 )%Phase = ray2D( is )%Phase + pi</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">711</div>
            <div class="execution-count">-</div>
            <div class="source-code">  CASE ( &#x27;F&#x27; )                 ! file</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">712</div>
            <div class="execution-count">115260</div>
            <div class="source-code">     RInt%theta = RadDeg * ABS( ATAN2( Th, Tg ) )           ! angle of incidence (relative to normal to bathymetry)</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">713</div>
            <div class="execution-count">115260*</div>
            <div class="source-code">     IF ( RInt%theta &gt; 90 ) RInt%theta = 180. - RInt%theta  ! reflection coefficient is symmetric about 90 degrees</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">714</div>
            <div class="execution-count">115260*</div>
            <div class="source-code">     CALL InterpolateReflectionCoefficient( RInt, RefC, Npts, PRTFile )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">715</div>
            <div class="execution-count">115260*</div>
            <div class="source-code">     ray2D( is1 )%Amp   = ray2D( is )%Amp * RInt%R</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">716</div>
            <div class="execution-count">115260*</div>
            <div class="source-code">     ray2D( is1 )%Phase = ray2D( is )%Phase + RInt%phi</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">717</div>
            <div class="execution-count">-</div>
            <div class="source-code">  CASE ( &#x27;A&#x27;, &#x27;G&#x27; )            ! half-space</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">718</div>
            <div class="execution-count">525807</div>
            <div class="source-code">     kx = omega * Tg     ! wavenumber in direction parallel      to bathymetry</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">719</div>
            <div class="execution-count">525807</div>
            <div class="source-code">     kz = omega * Th     ! wavenumber in direction perpendicular to bathymetry (in ocean)</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">720</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">721</div>
            <div class="execution-count">-</div>
            <div class="source-code">     ! notation below is a bit misleading</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">722</div>
            <div class="execution-count">-</div>
            <div class="source-code">     ! kzS, kzP is really what I called gamma in other codes, and differs by a factor of +/- i</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">723</div>
            <div class="execution-count">525807</div>
            <div class="source-code">     IF ( REAL( HS%cS ) &gt; 0.0 ) THEN</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">724</div>
            <div class="execution-count">#####</div>
            <div class="source-code">        kzS2 = kx ** 2 - ( omega / HS%cS ) ** 2</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">725</div>
            <div class="execution-count">#####</div>
            <div class="source-code">        kzP2 = kx ** 2 - ( omega / HS%cP ) ** 2</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">726</div>
            <div class="execution-count">#####</div>
            <div class="source-code">        kzS  = SQRT( kzS2 )</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">727</div>
            <div class="execution-count">#####</div>
            <div class="source-code">        kzP  = SQRT( kzP2 )</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">728</div>
            <div class="execution-count">#####</div>
            <div class="source-code">        mu   = HS%rho * HS%cS ** 2</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">729</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">730</div>
            <div class="execution-count">#####</div>
            <div class="source-code">        y2 = ( ( kzS2 + kx ** 2 ) ** 2 - 4.0D0 * kzS * kzP * kx ** 2 ) * mu</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">731</div>
            <div class="execution-count">#####</div>
            <div class="source-code">        y4 = kzP * ( kx ** 2 - kzS2 )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">732</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">733</div>
            <div class="execution-count">#####</div>
            <div class="source-code">        f = omega ** 2 * y4</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">734</div>
            <div class="execution-count">#####</div>
            <div class="source-code">        g = y2</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">735</div>
            <div class="execution-count">-</div>
            <div class="source-code">     ELSE</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">736</div>
            <div class="execution-count">525807</div>
            <div class="source-code">        kzP = SQRT( kx ** 2 - ( omega / HS%cP ) ** 2 )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">737</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">738</div>
            <div class="execution-count">-</div>
            <div class="source-code">        ! Intel and GFortran compilers return different branches of the SQRT for negative reals</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">739</div>
            <div class="execution-count">525807</div>
            <div class="source-code">        IF ( REAL( kzP ) == 0.0D0 .AND. AIMAG( kzP ) &lt; 0.0D0 ) kzP = -kzP</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">740</div>
            <div class="execution-count">525807</div>
            <div class="source-code">        f   = kzP</div>
        </div>
        <div class="code-line executed">
            <div class="line-number">741</div>
            <div class="execution-count">525807</div>
            <div class="source-code">        g   = HS%rho</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">742</div>
            <div class="execution-count">-</div>
            <div class="source-code">     ENDIF</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">743</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line executed">
            <div class="line-number">744</div>
            <div class="execution-count">525807</div>
            <div class="source-code">     Refl =  - ( rho * f - i * kz * g ) / ( rho * f + i * kz * g )   ! complex reflection coef.</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">745</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">746</div>
            <div class="execution-count">1051614*</div>
            <div class="source-code">     IF ( ABS( Refl ) &lt; 1.0E-5 ) THEN   ! kill a ray that has lost its energy in reflection</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">747</div>
            <div class="execution-count">507*</div>
            <div class="source-code">        ray2D( is1 )%Amp   = 0.0</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">748</div>
            <div class="execution-count">507*</div>
            <div class="source-code">        ray2D( is1 )%Phase = ray2D( is )%Phase</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">749</div>
            <div class="execution-count">-</div>
            <div class="source-code">     ELSE</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">750</div>
            <div class="execution-count">525300*</div>
            <div class="source-code">        ray2D( is1 )%Amp   = ABS( Refl ) * ray2D(  is )%Amp</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">751</div>
            <div class="execution-count">525300*</div>
            <div class="source-code">        ray2D( is1 )%Phase = ray2D( is )%Phase + ATAN2( AIMAG( Refl ), REAL( Refl ) )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">752</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">753</div>
            <div class="execution-count">-</div>
            <div class="source-code">        ! compute beam-displacement Tindle, Eq. (14)</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">754</div>
            <div class="execution-count">-</div>
            <div class="source-code">        ! needs a correction to beam-width as well ...</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">755</div>
            <div class="execution-count">-</div>
            <div class="source-code">        !  IF ( REAL( kz2Sq ) &lt; 0.0 ) THEN</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">756</div>
            <div class="execution-count">-</div>
            <div class="source-code">        !     rhoW   = 1.0   ! density of water</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">757</div>
            <div class="execution-count">-</div>
            <div class="source-code">        !     rhoWSq  = rhoW  * rhoW</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">758</div>
            <div class="execution-count">-</div>
            <div class="source-code">        !     rhoHSSq = rhoHS * rhoHS</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">759</div>
            <div class="execution-count">-</div>
            <div class="source-code">        !     DELTA = 2 * GK * rhoW * rhoHS * ( kz1Sq - kz2Sq ) /</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">760</div>
            <div class="execution-count">-</div>
            <div class="source-code">        ! &amp;( kz1 * i * kz2 *</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">761</div>
            <div class="execution-count">-</div>
            <div class="source-code">        ! &amp;( -rhoWSq * kz2Sq + rhoHSSq * kz1Sq ) )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">762</div>
            <div class="execution-count">-</div>
            <div class="source-code">        !     RV( is + 1 ) = RV( is + 1 ) + DELTA</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">763</div>
            <div class="execution-count">-</div>
            <div class="source-code">        !  END IF</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">764</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line executed">
            <div class="line-number">765</div>
            <div class="execution-count">525300</div>
            <div class="source-code">        if ( Beam%Type( 4 : 4 ) == &#x27;S&#x27; ) then   ! beam displacement &amp; width change (Seongil&#x27;s version)</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">766</div>
            <div class="execution-count">#####</div>
            <div class="source-code">           ch = ray2D( is )%c / conjg( HS%cP )</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">767</div>
            <div class="execution-count">#####</div>
            <div class="source-code">           co = ray2D( is )%t( 1 ) * ray2D( is )%c</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">768</div>
            <div class="execution-count">#####</div>
            <div class="source-code">           si = ray2D( is )%t( 2 ) * ray2D( is )%c</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">769</div>
            <div class="execution-count">#####</div>
            <div class="source-code">           ck = omega / ray2D( is )%c</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">770</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">771</div>
            <div class="execution-count">#####</div>
            <div class="source-code">           a   = 2 * HS%rho * ( 1 - ch * ch )</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">772</div>
            <div class="execution-count">#####</div>
            <div class="source-code">           b   = co * co - ch * ch</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">773</div>
            <div class="execution-count">#####</div>
            <div class="source-code">           d   = HS%rho * HS%rho * si * si + b</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">774</div>
            <div class="execution-count">#####</div>
            <div class="source-code">           sb  = sqrt( b )</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">775</div>
            <div class="execution-count">#####</div>
            <div class="source-code">           cco = co * co</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">776</div>
            <div class="execution-count">#####</div>
            <div class="source-code">           ssi = si * si</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">777</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">778</div>
            <div class="execution-count">#####</div>
            <div class="source-code">           IF ( si /= 0.0 ) THEN</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">779</div>
            <div class="execution-count">#####</div>
            <div class="source-code">              delta = a * co / si / ( ck * sb * d )   ! Do we need an abs() on this???</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">780</div>
            <div class="execution-count">-</div>
            <div class="source-code">           ELSE</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">781</div>
            <div class="execution-count">#####</div>
            <div class="source-code">              delta = 0.0</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">782</div>
            <div class="execution-count">-</div>
            <div class="source-code">           END IF</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">783</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">784</div>
            <div class="execution-count">#####</div>
            <div class="source-code">           pdelta  = real( delta ) / ( ray2D( is )%c / co)</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">785</div>
            <div class="execution-count">-</div>
            <div class="source-code">           ddelta  = -a / ( ck*sb*d ) - a*cco / ssi / (ck*sb*d) + a*cco / (ck*b*sb*d) &amp;</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">786</div>
            <div class="execution-count">#####</div>
            <div class="source-code">                     -a*co / si / (ck*sb*d*d) * (2* HS%rho * HS%rho *si*co-2*co*si)</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">787</div>
            <div class="execution-count">#####</div>
            <div class="source-code">           rddelta = -real( ddelta )</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">788</div>
            <div class="execution-count">#####</div>
            <div class="source-code">           sddelta = rddelta / abs( rddelta )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">789</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">790</div>
            <div class="execution-count">-</div>
            <div class="source-code">           ! next 3 lines have an update by Diana McCammon to allow a sloping bottom</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">791</div>
            <div class="execution-count">-</div>
            <div class="source-code">           ! I think the formulas are good, but this won&#x27;t be reliable because it doesn&#x27;t have the logic</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">792</div>
            <div class="execution-count">-</div>
            <div class="source-code">           ! that tracks crossing into new segments after the ray displacement.</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">793</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">794</div>
            <div class="execution-count">#####</div>
            <div class="source-code">           theta_bot = datan( tBdry( 2 ) / tBdry( 1 ))  ! bottom angle</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">795</div>
            <div class="execution-count">#####</div>
            <div class="source-code">           ray2D( is1 )%x( 1 ) = ray2D( is1 )%x( 1 ) + real( delta ) * dcos( theta_bot )       ! range displacement</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">796</div>
            <div class="execution-count">#####</div>
            <div class="source-code">           ray2D( is1 )%x( 2 ) = ray2D( is1 )%x( 2 ) + real( delta ) * dsin( theta_bot )       ! depth displacement</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">797</div>
            <div class="execution-count">#####</div>
            <div class="source-code">           ray2D( is1 )%tau    = ray2D( is1 )%tau + pdelta                                     ! phase change</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">798</div>
            <div class="execution-count">#####</div>
            <div class="source-code">           ray2D( is1 )%q      = ray2D( is1 )%q + sddelta * rddelta * si * c * ray2D( is )%p   ! beam-width change</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">799</div>
            <div class="execution-count">-</div>
            <div class="source-code">        endif</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">800</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">801</div>
            <div class="execution-count">-</div>
            <div class="source-code">     ENDIF</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">802</div>
            <div class="execution-count">-</div>
            <div class="source-code">  CASE DEFAULT</div>
        </div>
        <div class="code-line not-executed">
            <div class="line-number">803</div>
            <div class="execution-count">#####</div>
            <div class="source-code">     WRITE( PRTFile, * ) &#x27;HS%BC = &#x27;, HS%BC</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">804</div>
            <div class="execution-count">1244431*</div>
            <div class="source-code">     CALL ERROUT( &#x27;Reflect2D&#x27;, &#x27;Unknown boundary condition type&#x27; )</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">805</div>
            <div class="execution-count">-</div>
            <div class="source-code">  END SELECT</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">806</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line executed">
            <div class="line-number">807</div>
            <div class="execution-count">1244431</div>
            <div class="source-code">END SUBROUTINE Reflect2D</div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">808</div>
            <div class="execution-count">-</div>
            <div class="source-code"></div>
        </div>
        <div class="code-line non-executable">
            <div class="line-number">809</div>
            <div class="execution-count">-</div>
            <div class="source-code">END PROGRAM BELLHOP</div>
        </div>
    </div>

    <div class="footer">
        <p><strong>Legend:</strong></p>
        <ul>
            <li><span style="background-color: #d4edda; padding: 2px 4px;">Green</span> - Executed lines</li>
            <li><span style="background-color: #f8d7da; padding: 2px 4px;">Red</span> - Not executed lines</li>
            <li><span style="background-color: #f8f9fa; padding: 2px 4px;">Gray</span> - Non-executable lines (comments, declarations)</li>
        </ul>
        <p><strong>Execution Count:</strong> Number of times each line was executed. ##### indicates never executed, - indicates non-executable.</p>
    </div>
</body>
</html>